(function(c){function e(a){return typeof a=="object"?a:{top:a,left:a}}var b=c.scrollTo=function(a,b,d){c(window).scrollTo(a,b,d)};b.defaults={axis:"xy",duration:parseFloat(c.fn.jquery)>=1.3?0:1};b.window=function(){return c(window)._scrollable()};c.fn._scrollable=function(){return this.map(function(){if(this.nodeName&&c.inArray(this.nodeName.toLowerCase(),["iframe","#document","html","body"])==-1)return this;var a=(this.contentWindow||this).document||this.ownerDocument||this;return c.browser.safari||
a.compatMode=="BackCompat"?a.body:a.documentElement})};c.fn.scrollTo=function(a,f,d){typeof f=="object"&&(d=f,f=0);typeof d=="function"&&(d={onAfter:d});a=="max"&&(a=9E9);d=c.extend({},b.defaults,d);f=f||d.speed||d.duration;d.queue=d.queue&&d.axis.length>1;d.queue&&(f/=2);d.offset=e(d.offset);d.over=e(d.over);return this._scrollable().each(function(){function m(b){g.animate(j,f,d.easing,b&&function(){b.call(this,a,d)})}var h=this,g=c(h),i=a,l,j={},p=g.is("html,body");switch(typeof i){case "number":case "string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(i)){i=
e(i);break}i=c(i,this);case "object":if(i.is||i.style)l=(i=c(i)).offset()}c.each(d.axis.split(""),function(a,f){var c=f=="x"?"Left":"Top",e=c.toLowerCase(),k="scroll"+c,n=h[k],o=b.max(h,f);l?(j[k]=l[e]+(p?0:n-g.offset()[e]),d.margin&&(j[k]-=parseInt(i.css("margin"+c))||0,j[k]-=parseInt(i.css("border"+c+"Width"))||0),j[k]+=d.offset[e]||0,d.over[e]&&(j[k]+=i[f=="x"?"width":"height"]()*d.over[e])):(c=i[e],j[k]=c.slice&&c.slice(-1)=="%"?parseFloat(c)/100*o:c);/^\d+$/.test(j[k])&&(j[k]=j[k]<=0?0:Math.min(j[k],
o));!a&&d.queue&&(n!=j[k]&&m(d.onAfterFirst),delete j[k])});m(d.onAfter)}).end()};b.max=function(a,b){var d=b=="x"?"Width":"Height",e="scroll"+d;if(!c(a).is("html,body"))return a[e]-c(a)[d.toLowerCase()]();var d="client"+d,h=a.ownerDocument.documentElement,g=a.ownerDocument.body;return Math.max(h[e],g[e])-Math.min(h[d],g[d])}})(jQuery);
(function(c){c.flexslider=function(e,b){var a=e;a.init=function(){a.vars=c.extend({},c.flexslider.defaults,b);a.data("flexslider",true);a.container=c(".slides",a);a.slides=c(".slides > li",a);a.count=a.slides.length;a.animating=false;a.currentSlide=a.vars.slideToStart;a.animatingTo=a.currentSlide;a.atEnd=a.currentSlide==0?true:false;a.eventType="ontouchstart"in document.documentElement?"touchstart":"click";a.cloneCount=0;a.cloneOffset=0;if(a.vars.controlsContainer!="")a.controlsContainer=c(a.vars.controlsContainer).eq(c(".slides").index(a.container)),
a.containerExists=a.controlsContainer.length>0;if(a.vars.manualControls!="")a.manualControls=c(a.vars.manualControls,a.containerExists?a.controlsContainer:a),a.manualExists=a.manualControls.length>0;a.vars.randomize&&(a.slides.sort(function(){return Math.round(Math.random())-0.5}),a.container.empty().append(a.slides));if(a.vars.animation.toLowerCase()=="slide"){a.css({overflow:"hidden"});if(a.vars.animationLoop)a.cloneCount=2,a.cloneOffset=1,a.container.append(a.slides.filter(":first").clone().addClass("clone")).prepend(a.slides.filter(":last").clone().addClass("clone"));
a.container.width((a.count+a.cloneCount)*a.width()+2E3);a.newSlides=c(".slides > li",a);setTimeout(function(){a.newSlides.width(a.width()).css({"float":"left"}).show()},100);a.container.css({marginLeft:-1*(a.currentSlide+a.cloneOffset)*a.width()+"px"})}else a.slides.css({width:"100%","float":"left",marginRight:"-100%"}).eq(a.currentSlide).fadeIn(400);if(a.vars.controlNav){if(a.manualExists)a.controlNav=a.manualControls;else{for(var f=c('<ol class="flex-control-nav"></ol>'),d=1,e=0;e<a.count;e++)f.append("<li><a>"+
d+"</a></li>"),d++;a.containerExists?(c(a.controlsContainer).append(f),a.controlNav=c(".flex-control-nav li a",a.controlsContainer)):(a.append(f),a.controlNav=c(".flex-control-nav li a",a))}a.controlNav.eq(a.currentSlide).addClass("active");a.controlNav.bind(a.eventType,function(b){b.preventDefault();c(this).hasClass("active")||a.flexAnimate(a.controlNav.index(c(this)),a.vars.pauseOnAction)})}if(a.vars.directionNav)f=c('<ul class="flex-direction-nav"><li><a class="prev" href="#">'+a.vars.prevText+
'</a></li><li><a class="next" href="#">'+a.vars.nextText+"</a></li></ul>"),a.containerExists?(c(a.controlsContainer).append(f),a.directionNav=c(".flex-direction-nav li a",a.controlsContainer)):(a.append(f),a.directionNav=c(".flex-direction-nav li a",a)),a.vars.animationLoop||(a.currentSlide==0?a.directionNav.filter(".prev").addClass("disabled"):a.currentSlide==a.count-1&&a.directionNav.filter(".next").addClass("disabled")),a.directionNav.bind(a.eventType,function(b){b.preventDefault();b=c(this).hasClass("next")?
a.getTarget("next"):a.getTarget("prev");a.canAdvance(b)&&a.flexAnimate(b,a.vars.pauseOnAction)});a.vars.keyboardNav&&c("ul.slides").length==1&&c(document).keyup(function(b){if(!a.animating&&!(b.keyCode!=39&&b.keyCode!=37)){if(b.keyCode==39)var f=a.getTarget("next");else b.keyCode==37&&(f=a.getTarget("prev"));a.canAdvance(f)&&a.flexAnimate(f,a.vars.pauseOnAction)}});if(a.vars.slideshow)a.vars.pauseOnHover&&a.vars.slideshow&&a.hover(function(){a.pause()},function(){a.resume()}),a.animatedSlides=setInterval(a.animateSlides,
a.vars.slideshowSpeed);if(a.vars.pausePlay)f=c('<div class="flex-pauseplay"><span></span></div>'),a.containerExists?(a.controlsContainer.append(f),a.pausePlay=c(".flex-pauseplay span",a.controlsContainer)):(a.append(f),a.pausePlay=c(".flex-pauseplay span",a)),f=a.vars.slideshow?"pause":"play",a.pausePlay.addClass(f).text(f=="pause"?a.vars.pauseText:a.vars.playText),a.pausePlay.click(function(b){b.preventDefault();c(this).hasClass("pause")?a.pause():a.resume()});a.vars.touchSwipe&&"ontouchstart"in
document.documentElement&&a.each(function(){function b(){this.removeEventListener("touchmove",f);c=null;isMoving=false}function f(d){isMoving&&(d=c-d.touches[0].pageX,Math.abs(d)>=e&&(b(),d=d>0?a.getTarget("next"):a.getTarget("prev"),a.canAdvance(d)&&a.flexAnimate(d,a.vars.pauseOnAction)))}function d(a){if(a.touches.length==1)c=a.touches[0].pageX,isMoving=true,this.addEventListener("touchmove",f,false)}var c,e=20;isMoving=false;"ontouchstart"in document.documentElement&&this.addEventListener("touchstart",
d,false)});a.vars.animation.toLowerCase()=="slide"&&c(window).resize(function(){a.newSlides.width(a.width());a.container.width((a.count+a.cloneCount)*a.width()+2E3);clearTimeout(a.sliderTimer);a.sliderTimer=setTimeout(function(){a.flexAnimate(a.currentSlide)},300)});a.vars.start(a)};a.flexAnimate=function(b,d){if(!a.animating)a.animating=true,a.animatingTo=b,a.vars.before(a),d&&a.pause(),a.vars.controlNav&&a.controlNav.removeClass("active").eq(b).addClass("active"),a.atEnd=b==0||b==a.count-1?true:
false,!a.vars.animationLoop&&a.vars.directionNav&&(b==0?a.directionNav.removeClass("disabled").filter(".prev").addClass("disabled"):b==a.count-1?a.directionNav.removeClass("disabled").filter(".next").addClass("disabled"):a.directionNav.removeClass("disabled")),!a.vars.animationLoop&&b==a.count-1&&(a.pause(),a.vars.end(a)),a.vars.animation.toLowerCase()=="slide"?(a.slideString=a.currentSlide==0&&b==a.count-1&&a.vars.animationLoop&&a.direction!="next"?"0px":a.currentSlide==a.count-1&&b==0&&a.vars.animationLoop&&
a.direction!="prev"?-1*(a.count+1)*a.slides.filter(":first").width()+"px":-1*(b+a.cloneOffset)*a.slides.filter(":first").width()+"px",a.container.animate({marginLeft:a.slideString},a.vars.animationDuration,function(){a.currentSlide==0&&b==a.count-1&&a.vars.animationLoop?a.container.css({marginLeft:-1*a.count*a.slides.filter(":first").width()+"px"}):a.currentSlide==a.count-1&&b==0&&a.vars.animationLoop&&a.container.css({marginLeft:-1*a.slides.filter(":first").width()+"px"});a.animating=false;a.currentSlide=
b;a.vars.after(a)})):(a.slides.eq(a.currentSlide).fadeOut(a.vars.animationDuration),a.slides.eq(b).fadeIn(a.vars.animationDuration,function(){a.animating=false;a.currentSlide=b;a.vars.after(a)}))};a.animateSlides=function(){a.animating||a.flexAnimate(a.currentSlide==a.count-1?0:a.currentSlide+1)};a.pause=function(){clearInterval(a.animatedSlides);a.vars.pausePlay&&a.pausePlay.removeClass("pause").addClass("play").text(a.vars.playText)};a.resume=function(){a.animatedSlides=setInterval(a.animateSlides,
a.vars.slideshowSpeed);a.vars.pausePlay&&a.pausePlay.removeClass("play").addClass("pause").text(a.vars.pauseText)};a.canAdvance=function(b){return!a.vars.animationLoop&&a.atEnd?a.currentSlide==0&&b==a.count-1&&a.direction!="next"?false:a.currentSlide==a.count-1&&b==0&&a.direction=="next"?false:true:true};a.getTarget=function(b){a.direction=b;return b=="next"?a.currentSlide==a.count-1?0:a.currentSlide+1:a.currentSlide==0?a.count-1:a.currentSlide-1};a.init()};c.flexslider.defaults={animation:"fade",
slideshow:true,slideshowSpeed:7E3,animationDuration:600,directionNav:true,controlNav:true,keyboardNav:true,touchSwipe:true,prevText:"Previous",nextText:"Next",pausePlay:false,pauseText:"Pause",playText:"Play",randomize:false,slideToStart:0,animationLoop:true,pauseOnAction:true,pauseOnHover:false,controlsContainer:"",manualControls:"",start:function(){},before:function(){},after:function(){},end:function(){}};c.fn.flexslider=function(e){return this.each(function(){c(this).find(".slides li").length==
1?c(this).find(".slides li").fadeIn(400):c(this).data("flexslider")!=true&&new c.flexslider(c(this),e)})}})(jQuery);
var opTheme=function(){var c=function(b){console!==void 0&&console.log!==void 0&&console.log(b)},e=void 0;return{callback:{keyboard:function(){c("keyboard!!!!")},actionDelete:function(b){b.preventDefault();var b=$(b.target),a=b.attr("href")+".json",c=b.attr("data-id");OP.Util.makeRequest(a,b.parent().serializeArray(),function(a){a.code===200?$(".action-container-"+c).hide("medium",function(){$(this).remove()}):opTheme.message.error("Could not delete the photo.")});return false},commentJump:function(b){b.preventDefault();
$.scrollTo($("div.comment-form"),200);return false},credentailDelete:function(b){b.preventDefault();var a=$(b.target),b=a.attr("href")+".json";OP.Util.makeRequest(b,{},function(b){b.code===200?(a.parent().remove(),opTheme.message.confirm("Credential successfully deleted.")):opTheme.message.error("Could not delete credential.")});return false},groupCheckbox:function(b){b=$(b.target);b.hasClass("none")&&b.is(":checked")?$("input.group-checkbox:not(.none)").removeAttr("checked"):b.is(":checked")&&$("input.group-checkbox.none").removeAttr("checked")},
groupPost:function(b){b.preventDefault();var b=$(b.target).parent(),a=b.attr("action")+".json",c=a.search("create")>-1;OP.Util.makeRequest(a,b.serializeArray(),function(a){a.code===200?c?location.href=location.href:opTheme.message.confirm("Group updated successfully."):opTheme.message.error("Could not update group.")});return false},login:function(b){b=$(b.target);b.hasClass("browserid")?navigator.id.getVerifiedEmail(function(a){a?opTheme.user.browserid.loginSuccess(a):opTheme.user.browserid.loginFailure(a)}):
b.hasClass("facebook")&&FB.login(function(a){a.authResponse?(console.log("User logged in, posting to openphoto host."),OP.Util.makeRequest("/user/facebook/login.json",opTheme.user.base.loginProcessed)):console.log("User cancelled login or did not fully authorize.")},{scope:"email"})},photoDelete:function(b){b.preventDefault();var a=$(b.target),b=a.parent().attr("action")+".json";OP.Util.makeRequest(b,a.parent().serializeArray(),function(b){b.code===200?(a.html("This photo has been deleted"),opTheme.message.confirm("This photo has been deleted.")):
opTheme.message.error("Could not delete the photo.")});return false},photoEdit:function(b){b.preventDefault();b=$(b.target).attr("href")+".json";$("div.owner-edit").length==1?$.scrollTo($("div.owner-edit"),200):OP.Util.makeRequest(b,{},function(a){a.code===200?($("#main").append(a.result.markup),$.scrollTo($("div.owner-edit"),200)):opTheme.message.error("Could not load the form to edit this photo.")},"json","get");return false},pluginStatus:function(b){b.preventDefault();b=$(b.target).attr("href")+
".json";OP.Util.makeRequest(b,{},function(a){a.code===200?window.location.reload():opTheme.message.error("Could not update the status of this plugin.")},"json","post");return false},pluginUpdate:function(b){b.preventDefault();var b=$(b.target).parent(),a=b.attr("action")+".json";OP.Util.makeRequest(a,b.serializeArray(),function(a){a.code===200?opTheme.message.confirm("Your plugin was successfully updated."):opTheme.message.error("Could not update the status of this plugin.")},"json","post");return false},
searchByTags:function(b){b.preventDefault();var a=$(b.target).parent(),b=$(a.find("input[name=tags]")[0]).val(),a=$(a).attr("action");location.href=b.length>0?a.replace("/list","")+"/tags-"+b+"/list":a;return false},settings:function(){$("ul#settingsbar").slideToggle("medium");$("li#nav-signin").toggleClass("active");return false},keyBrowseNext:function(){var b;if(b=$(".image-pagination .next a").attr("href"))location.href=b},keyBrowsePrevious:function(){var b;if(b=$(".image-pagination .previous a").attr("href"))location.href=
b},webhookDelete:function(b){b.preventDefault();var a=$(b.target),b=a.attr("href")+".json";OP.Util.makeRequest(b,{},function(b){b.code===200?(a.parent().remove(),opTheme.message.confirm("Credential successfully deleted.")):opTheme.message.error("Could not delete credential.")});return false}},formHandlers:{hasErrors:function(b,a){var c=[];b.children("input, textarea").each(function(){var d=$(this);d.prev().removeClass("error");var e=d.attr(a);if(e!=void 0)for(var e=e.split(" "),h=0;h<e.length;h++){if(e[h]==
"date"&&!opTheme.formHandlers.passesDate(d)){var g=d.prev().html()+" is not a valid date";c.push([d,g])}e[h]=="email"&&!opTheme.formHandlers.passesEmail(d)&&(g=d.prev().html()+" is not a valid email address",c.push([d,g]));e[h]=="ifexists"&&d.val()!=""&&d.val()!=void 0&&$.merge(c,opTheme.formHandlers.hasErrors(b,"data-ifexists"));e[h]=="integer"&&!opTheme.formHandlers.passesInteger(d)&&(g=d.prev().html()+" is not a number",c.push([d,g]));e[h]=="match"&&(g=d.attr("data-match"),opTheme.formHandlers.passesMatch(d,
g)||(g=d.prev().html()+" does not match "+$("#"+g).prev().html(),c.push([d,g])));e[h]=="required"&&!opTheme.formHandlers.passesRequired(d)&&(g=d.prev().html()+" is required",c.push([d,g]));e[h]=="alphanumeric"&&!opTheme.formHandlers.passesAlphaNumeric(d)&&(g=d.prev().html()+" can only contain alpha-numeric characters",c.push([d,g]))}});return c},init:function(){$(this).submit(opTheme.submitHandlers.siteForm);opTheme.formHandlers.showPlaceholders();$("input[data-placeholder]").live("focus",opTheme.formHandlers.placeholderFocus);
$("input[data-placeholder]").live("blur",opTheme.formHandlers.placeholderBlur)},passesAlphaNumeric:function(b){return/^[a-zA-Z0-9]+$/.test(b.val())},passesDate:function(b){return/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(b.val())},passesEmail:function(b){return/^([\w-\.+]+@([\w-]+\.)+[\w-]{2,4})?$/.test(b.val())},passesInteger:function(b){return/^\d+$/.test(b.val())},passesMatch:function(b,a){return b.val()==$("#"+a).val()},passesRequired:function(b){return b.is("textarea")||b.is("input")&&(b.attr("type")==
"text"||b.attr("type")=="password")?b.val()!=""&&b.val()!=void 0:b.is("checkbox")?b.is(":checked"):true},placeholderBlur:function(){var b=$(this);b.val()==""&&(b.val(b.attr("data-placeholder")),b.addClass("placeholder"))},placeholderFocus:function(){var b=$(this);b.val()==b.attr("data-placeholder")&&(b.val(""),b.removeClass("placeholder"))},removePlaceholders:function(){$("input[data-placeholder]").each(function(){var b=$(this);b.val()==b.attr("data-placeholder")&&(b.val(""),b.removeClass("placeholder"))})},
showPlaceholders:function(){$("input[data-placeholder]").each(function(){var b=$(this);b.val()==""&&(b.val(b.attr("data-placeholder")),b.addClass("placeholder"))})}},front:{init:function(b){b.length>0&&b.cycle({fx:"fade"}).find("img").click(function(a){location.href=$(a.target).attr("data-origin")})}},init:{load:function(){$("section#slideshow").length>0&&$(window).load(function(){$(".flexslider").flexslider({animation:"slide",controlsContainer:".flex-container",controlNav:true,pausePlay:false,directionNav:true,
nextText:"<span title='Next'>Next</span>",prevText:"<span title='Previous'>Previous</span>"})})},attach:function(){OP.Util.on("click:action-delete",opTheme.callback.actionDelete);OP.Util.on("click:action-jump",opTheme.callback.commentJump);OP.Util.on("click:credential-delete",opTheme.callback.credentailDelete);OP.Util.on("click:group-checkbox",opTheme.callback.groupCheckbox);OP.Util.on("click:group-update",opTheme.callback.groupPost);OP.Util.on("click:login",opTheme.callback.login);OP.Util.on("click:photo-delete",
opTheme.callback.photoDelete);OP.Util.on("click:photo-edit",opTheme.callback.photoEdit);OP.Util.on("click:plugin-status",opTheme.callback.pluginStatus);OP.Util.on("click:plugin-update",opTheme.callback.pluginUpdate);OP.Util.on("click:nav-item",opTheme.callback.searchBarToggle);OP.Util.on("click:search",opTheme.callback.searchByTags);OP.Util.on("click:settings",opTheme.callback.settings);OP.Util.on("click:webhook-delete",opTheme.callback.webhookDelete);OP.Util.on("keydown:browse-next",opTheme.callback.keyBrowseNext);
OP.Util.on("keydown:browse-previous",opTheme.callback.keyBrowsePrevious);opTheme.front.init($("div.front-slideshow"));typeof OPU==="object"&&OPU.init();$("form.validate").each(opTheme.formHandlers.init)}},message:{close:function(){e!=void 0&&(clearTimeout(e),e=void 0,$("#message-box").animate({height:"toggle"},500,function(){$("#message-box").remove()}))},confirm:function(b){opTheme.message.show(b,"confirm")},error:function(b){opTheme.message.show(b,"error")},show:function(b,a){var c=a=="error"?"confirm":
"error";e!=void 0?(clearTimeout(e),e=void 0,$("#message-box").removeClass(c).addClass(a).html('<div><a class="message-close">close</a>'+b+"</div>"),e=setTimeout(function(){$("#message-box").animate({height:"toggle"},500,function(){$("#message-box").remove();e=void 0})},7E3)):($("html").append('<section id="message-box" style="display:none;"><div><a class="message-close">close</a>'+b+"</div></section>"),$("#message-box").removeClass(c).addClass(a).animate({height:"toggle"},500,function(){e=setTimeout(function(){$("#message-box").animate({height:"toggle"},
500,function(){$("#message-box").remove();e=void 0})},7E3)}));$("a.message-close").click(opTheme.message.close)}},submitHandlers:{siteForm:function(b){var a=$(this);b.preventDefault();opTheme.formHandlers.removePlaceholders();b=opTheme.formHandlers.hasErrors(a,"data-validation");opTheme.formHandlers.showPlaceholders();if(b.length==0)this.submit();else{for(var a="<ul>",c=0;c<b.length;c++)b[c][0].prev().addClass("error"),a+="<li>"+b[c][1]+"</li>";a+="</ul>";$("html").animate({scrollTop:b[0][0].offset().top-
30},500);b[0][0].focus();opTheme.message.error(a)}}},user:{base:{loginProcessed:function(b){b.code!=200?c("processing of login failed"):(c("login processing succeeded"),window.location.reload())}},browserid:{loginFailure:function(){c("login failed")},loginSuccess:function(b){OP.Util.makeRequest("/user/browserid/login.json",{assertion:b},opTheme.user.base.loginProcessed)}}}}}();
