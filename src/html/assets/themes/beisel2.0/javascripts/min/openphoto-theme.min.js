var opTheme=function(){var k,g,f,e,l,j;k=function(){var a=null;return{get:function(){return a},set:function(b){a=b}}}();g=function(a){"undefined"!==typeof console&&"undefined"!==typeof console.log&&console.log(a)};f={message:function(a){var b="";1<arguments.length&&("error"==arguments[1]?b="error":"confirm"==arguments[1]&&(b="success"));return'<div class="alert-message block-message '+b+'"><a class="modal-close-click close" href="#">x</a>'+a+"</div>"},modal:function(a,b,c){return'<div class="modal-header">  <a href="#" class="close" data-dismiss="modal">&times;</a>  <h3>'+
a+'</h3></div><div class="modal-body">  <p>'+b+'</p></div><div class="modal-footer">'+c+"</div>"}};e=function(){return{clickHandler:function(a){var b=$(a.currentTarget).attr("href");if(History.enabled&&-1==b.search("#")&&(null===b.match(/^http/)||-1!=b.search(document.location.hostname)))a.preventDefault(),get(b)},get:function(a){e.url=a;$.get(e.url,e.store)},replace:function(a,b){var c=b||{};c.type="replace";History.replaceState(c,"",a)},insert:function(a,b){var c=b||{};c.type="insert";History.pushState(c,
"",a)},parse:function(a){var b=$(a),a=$("body",b).attr("class"),b=$(".content",b).html();return{bodyClass:a,content:b}},render:function(a){"replace"===a.type?$(".modal").modal("hide"):void 0!==a.content&&$("undefined"===typeof a.bodyClass||"photo-details"===a.bodyClass?"#modal-photo-detail":".content").fadeTo("fast",0.25,function(){$(this).html(a.content).fadeTo("fast",1)})},store:function(a){a=e.parse(a||{});a.type="store";History.pushState(a,"",e.url)}}}();j=function(){return{fetchAndCache:function(a){$("<img />").attr("src",
a).appendTo("body").css("display","none").on("load",function(a){$(a.target).remove()})},fetchAndCacheNextPrevious:function(){var a=$("img.next-photo"),b=$("img.previous-photo");0<b.length&&OP.Util.fire("preload:photo",{id:b.attr("data-id"),sizes:"870x550"});0<a.length&&OP.Util.fire("preload:photo",{id:a.attr("data-id"),sizes:"870x550"})}}}();return{callback:{actionDelete:function(a){a.preventDefault();var a=$(a.target),b=a.attr("href")+".json",c=a.attr("data-id");OP.Util.makeRequest(b,a.parent().serializeArray(),
function(a){204===a.code?$(".action-container-"+c).hide("medium",function(){$(this).remove()}):opTheme.message.error("Could not delete the photo.")});return!1},actionPost:function(a){a.preventDefault();var b=$("#favorite-form"),a=b.attr("action")+".json",b=b.serialize();$.ajax({url:a,type:"POST",data:b,dataType:"json",success:function(a){location.href=201===a.code?location.pathname+"?c=favorited":location.pathname+"?e=unknown"}})},batchAdd:function(a){$(".pin.photo-"+a.id).addClass("revealed pinned");
opTheme.ui.batchMessage();g("Adding photo "+a.id)},batchClear:function(){$(".pin.pinned").removeClass("revealed pinned");opTheme.ui.batchMessage()},batchField:function(a){var a=$(a.target).val(),b=$("form#batch-edit .form-fields");switch(a){case "delete":b.html(opTheme.ui.batchFormFields.empty());break;case "groups":b.html(opTheme.ui.batchFormFields.groups());break;case "permission":b.html(opTheme.ui.batchFormFields.permission());break;case "tagsAdd":case "tagsRemove":b.html(opTheme.ui.batchFormFields.tags())}},
batchModal:function(){var a=$("#modal"),b=f.modal("Batch edit your pinned photos",'<form id="batch-edit">  <div class="clearfix">    <label>What would you like to do?</label>    <div class="input">      <select id="batch-key" class="batch-field-change" name="property">        <option value="tagsAdd">Add Tags</option>        <option value="tagsRemove">Remove Tags</option>        <option value="groups">Update Groups</option>        <option value="permission">Update Permissions</option>        <option value="delete">Delete</option>      </select>    </div>  </div>  <div class="form-fields">'+
opTheme.ui.batchFormFields.tags()+"</div></form>",'<a href="#" class="btn photo-update-batch-click">Submit</a>');a.html(b).modal()},batchRemove:function(a){$(".pin.photo-"+a).removeClass("pinned revealed");opTheme.ui.batchMessage();g("Removing photo "+a)},commentJump:function(a){a.preventDefault();$.scrollTo($("div.comment-form"),200);return!1},credentailDelete:function(a){a.preventDefault();var b=$(a.target),a=b.attr("href")+".json";OP.Util.makeRequest(a,{},function(a){204===a.code?(b.parent().parent().slideUp("medium",
function(){this.remove()}),opTheme.message.confirm("Application successfully deleted.")):opTheme.message.error("Could not delete Application.")});return!1},groupCheckbox:function(a){a=$(a.target);a.hasClass("none")&&a.is(":checked")?$("input.group-checkbox:not(.none)").removeAttr("checked"):a.is(":checked")&&$("input.group-checkbox.none").removeAttr("checked")},groupDelete:function(a){a.preventDefault();var a=$(a.target),b=a.attr("href")+".json",c=a.parent();OP.Util.makeRequest(b,function(a){204===
a.code?c.slideUp("medium",function(){this.remove()}):opTheme.message.error("We could not delete this group.")})},groupEmailAdd:function(a){a.preventDefault();var a=$(a.target).prev(),b=$("ul.group-emails-add-list"),c=a.val();""!==c&&($('<li><span class="group-email-queue">'+c+'</span> <a href="#" class="group-email-remove-click"><i class="group-email-remove-click icon-minus-sign"></i></a></li>').prependTo(b),a.val(""))},groupEmailRemove:function(a){a.preventDefault();$(a.target).parent().parent().remove()},
groupPost:function(a){a.preventDefault();var a=$(a.target).parent(),b=a.attr("action")+".json",c=-1<b.search("create"),d,e={name:$('input[name="name"]',a).val()};$(".group-email-add-click",a).trigger("click");d=[];$("span.group-email-queue",a).each(function(a,b){d.push($(b).html())});e.members=d.join(",");OP.Util.makeRequest(b,e,function(a){200===a.code||201===a.code?c?location.href="/manage/groups?m=group-created":opTheme.message.confirm("Group updated successfully."):opTheme.message.error("Could not update group.")});
return!1},keyBrowseNext:function(a){!a.ctrlKey&&!a.altKey&&!a.metaKey&&$("img.next-photo").click()},keyBrowsePrevious:function(a){!a.ctrlKey&&!a.altKey&&!a.metaKey&&$("img.previous-photo").click()},login:function(a){a.preventDefault();a=$(a.target);a.hasClass("browserid")?navigator.id.getVerifiedEmail(function(a){a?opTheme.user.browserid.loginSuccess(a):opTheme.user.browserid.loginFailure(a)}):a.hasClass("facebook")&&FB.login(function(a){a.authResponse?(g("User logged in, posting to openphoto host."),
OP.Util.makeRequest("/user/facebook/login.json",opTheme.user.base.loginProcessed)):g("User cancelled login or did not fully authorize.")},{scope:"email"});return!1},loginModal:function(a){a.preventDefault();$("#loginBox").modal()},modalClose:function(a){a.preventDefault();$(a.target).parent().parent().slideUp("fast",function(){$(this).remove()})},modalUnload:function(){$("#modal-photo-detail").html("");e.replace(l)},photoDelete:function(a){a.preventDefault();var b=$(a.target),a=b.parent().attr("action")+
".json";OP.Util.makeRequest(a,b.parent().serializeArray(),function(a){204===a.code?(b.html("This photo has been deleted"),opTheme.message.confirm("This photo has been deleted.")):opTheme.message.error("Could not delete the photo.")});return!1},photoEdit:function(a){a.preventDefault();a="/photo/"+$(a.target).attr("data-id")+"/edit.json";OP.Util.makeRequest(a,{},function(a){if(200===a.code){var c=$("#modal"),a=f.modal("Edit this photo",a.result.markup,'<a href="#" class="btn btn-primary photo-update-click">Save</a>');
c.html(a).modal()}else opTheme.message.error("Could not load the form to edit this photo.")},"json","get");return!1},photoView:function(a){a.preventDefault();a=$(a.target).parent();$(".photo-view");var b=a.attr("href"),a=b;if($("body").hasClass("photo-details"))location.href=b;else{var c=$("#modal-photo-detail");$("#modal-photo-detail .photo-view");a=-1===a.indexOf("?")?a+"?modal=true":a+"&modal=true";c.load(a+" .photo-view",function(a){$("img.next-photo");$("img.previous-photo");e.insert(b,e.parse(a));
j.fetchAndCacheNextPrevious()})}return!1},photoViewModal:function(a){a.preventDefault();a=$(a.target).parent();$(".photo-view");var b=a=a.attr("href"),c=$("#modal-photo-detail"),b=-1===b.indexOf("?")?b+"?modal=true":b+"&modal=true";location.hash=a;c.load(b+" .photo-view",opTheme.callback.photoViewModalCb).modal().on("hidden",opTheme.callback.modalUnload);return!1},photoViewModalCb:function(a){j.fetchAndCacheNextPrevious();e.insert(location.hash,e.parse(a))},photoUpdate:function(){var a=$("#photo-edit-form"),
b=a.attr("action")+".json",a=a.serialize();OP.Util.makeRequest(b,a,opTheme.callback.photoUpdateCb,"json","post")},photoUpdateBatch:function(a){a.preventDefault();var b=$(a.target),a=$("#batch-key").val(),c=$("form#batch-edit").find("*[name='value']"),d;b.html("Submitting...").attr("disabled","disabled");1==c.length?d=c.val():(b=$("form#batch-edit").find("*[name='value']:checked"),1==b.length?d=b.val():(d=[],b.each(function(a,b){d.push($(b).val())}),d=d.join(",")));params={crumb:k.get()};params[a]=
d;params.ids=OP.Batch.collection.getIds().join(",");"delete"!==a?OP.Util.makeRequest("/photos/update.json",params,opTheme.callback.photoUpdateBatchCb,"json","post"):OP.Util.makeRequest("/photos/delete.json",params,opTheme.callback.photoUpdateBatchCb,"json","post")},photoUpdateBatchCb:function(a){200==a.code?opTheme.message.append(f.message("Your photos were successfully updated.","confirm")):204==a.code?(OP.Batch.clear(),opTheme.message.append(f.message("Your photos were successfully deleted.","confirm"))):
opTheme.message.append(f.message("There was a problem updating your photos.","error"));$("#modal").modal("hide")},photoUpdateCb:function(a){200===a.code?opTheme.message.confirm("Your photo was successfully updated."):opTheme.message.error("We could not update your photo.");$("#modal").modal("hide")},photosViewMore:function(a){a.preventDefault();opTheme.init.pages.photos.load()},pinClick:function(a){var a=$(a.target),b=a.attr("data-id");a.hasClass("pinned")?OP.Batch.remove(b):OP.Batch.add(b)},pinClearClick:function(a){a.preventDefault();
OP.Batch.clear()},pluginStatus:function(a){a.preventDefault();a=$(a.target).attr("href")+".json";OP.Util.makeRequest(a,{},function(a){200===a.code?window.location.reload():opTheme.message.error("Could not update the status of this plugin.")},"json","post");return!1},pluginUpdate:function(a){a.preventDefault();var a=$(a.target).parent(),b=a.attr("action")+".json";OP.Util.makeRequest(b,a.serializeArray(),function(a){200===a.code?opTheme.message.confirm("Your plugin was successfully updated."):opTheme.message.error("Could not update the status of this plugin.")},
"json","post");return!1},preloadPhoto:function(a){OP.Util.makeRequest("/photo/"+a.id+"/view.json",{returnSizes:a.sizes,generate:"true"},opTheme.callback.preloadPhotoCb,"json","get")},preloadPhotoCb:function(a){var b=a.result;if(200===a.code)for(i in b)b.hasOwnProperty(i)&&!0===/^path[0-9]/.test(i)&&j.fetchAndCache(b[i])},searchByTags:function(a){a.preventDefault();var a=$(a.target).parent().parent(),b=$($("input[name=tags]",a)[0]).val(),c=a.attr("action");0<b.length&&(0<c.search("/list")?location.href=
c.replace("/list","")+"/tags-"+b+"/list":a.submit());return!1},settings:function(){$("ul#settingsbar").slideToggle("medium");$("li#nav-signin").toggleClass("active");return!1},tagsInitialized:function(){var a=OP.Tag.getTags();null!==a&&0<a.length&&$(".typeahead-tags").typeahead({source:a,mode:"multiple"})},uploadCompleteSuccess:function(){$("form.upload").fadeOut("fast",function(){$(".upload-progress").fadeOut("fast",function(){$(".upload-complete").fadeIn("fast")});$(".upload-share").fadeIn("fast")})},
uploadCompleteFailure:function(){$("form.upload").fadeOut("fast",function(){$(".upload-progress").fadeOut("fast",function(){$(".upload-warning .failed").html(failed);$(".upload-warning .total").html(total);$(".upload-warning").fadeIn("fast")})})},webhookDelete:function(a){a.preventDefault();var b=$(a.target),a=b.attr("href")+".json";OP.Util.makeRequest(a,{},function(a){204===a.code?(b.parent().remove(),opTheme.message.confirm("Credential successfully deleted.")):opTheme.message.error("Could not delete credential.")});
return!1}},init:{load:function(a){var b="state"in window.history,c=location.href;k.set(a);OP.Tag.init();l=location.pathname;History.Adapter.bind(window,"statechange",function(){var a=History.getState(),g=!b&&location.href==c;b=!0;g||e.render(a.data)});"object"===typeof OPU&&OPU.init();$(".dropdown-toggle").dropdown();"/"===location.pathname?opTheme.init.pages.front():"/manage"===location.pathname?opTheme.init.pages.manage():0===location.pathname.search(/^\/photos(.*)\/list/)?opTheme.init.pages.photos.init():
(0===location.pathname.search(/^\/p\/[a-z0-9]+/)||0===location.pathname.search(/^\/photo\/[a-z0-9]+\/?(.*)\/view/))&&opTheme.init.pages.photo.init()},attach:function(){OP.Util.on("click:action-delete",opTheme.callback.actionDelete);OP.Util.on("click:action-jump",opTheme.callback.commentJump);OP.Util.on("click:action-post",opTheme.callback.actionPost);OP.Util.on("click:batch-modal",opTheme.callback.batchModal);OP.Util.on("click:credential-delete",opTheme.callback.credentailDelete);OP.Util.on("click:group-checkbox",
opTheme.callback.groupCheckbox);OP.Util.on("click:group-delete",opTheme.callback.groupDelete);OP.Util.on("click:group-email-add",opTheme.callback.groupEmailAdd);OP.Util.on("click:group-email-remove",opTheme.callback.groupEmailRemove);OP.Util.on("click:group-post",opTheme.callback.groupPost);OP.Util.on("click:login",opTheme.callback.login);OP.Util.on("click:login-modal",opTheme.callback.loginModal);OP.Util.on("click:modal-close",opTheme.callback.modalClose);OP.Util.on("click:nav-item",opTheme.callback.searchBarToggle);
OP.Util.on("click:photo-delete",opTheme.callback.photoDelete);OP.Util.on("click:photo-edit",opTheme.callback.photoEdit);OP.Util.on("click:plugin-status",opTheme.callback.pluginStatus);OP.Util.on("click:plugin-update",opTheme.callback.pluginUpdate);OP.Util.on("click:photo-update",opTheme.callback.photoUpdate);OP.Util.on("click:photo-update-batch",opTheme.callback.photoUpdateBatch);OP.Util.on("click:photo-view",opTheme.callback.photoView);OP.Util.on("click:photo-view-modal",opTheme.callback.photoViewModal);
OP.Util.on("click:photos-load-more",opTheme.callback.photosViewMore);OP.Util.on("click:pin",opTheme.callback.pinClick);OP.Util.on("click:pin-clear",opTheme.callback.pinClearClick);OP.Util.on("click:search",opTheme.callback.searchByTags);OP.Util.on("click:settings",opTheme.callback.settings);OP.Util.on("click:webhook-delete",opTheme.callback.webhookDelete);OP.Util.on("keydown:browse-next",opTheme.callback.keyBrowseNext);OP.Util.on("keydown:browse-previous",opTheme.callback.keyBrowsePrevious);OP.Util.on("change:batch-field",
opTheme.callback.batchField);OP.Util.on("callback:batch-add",opTheme.callback.batchAdd);OP.Util.on("callback:batch-remove",opTheme.callback.batchRemove);OP.Util.on("callback:batch-clear",opTheme.callback.batchClear);OP.Util.on("callback:tags-initialized",opTheme.callback.tagsInitialized);OP.Util.on("upload:complete-success",opTheme.callback.uploadCompleteSuccess);OP.Util.on("upload:complete-failure",opTheme.callback.uploadCompleteFailure);OP.Util.on("tags:autocomplete",opTheme.callback.tagsAutocomplete);
OP.Util.on("preload:photo",opTheme.callback.preloadPhoto)},pages:{front:function(){$(".carousel.front").swipe({swipeLeft:function(){("undefined"===typeof newBG||"undefined"===newBG)&&$(".carousel").carousel("next")},swipeRight:function(){("undefined"===typeof newBG||"undefined"===newBG)&&$(".carousel").carousel("prev")},threshold:100});$(".carousel.front").carousel({interval:7E3});$(".carousel.front").on("slid",function(){var a=$(".carousel.front .active"),a=parseInt(a.attr("data-index"))+1;$(".carouselthumbs .active").removeClass("active");
$(".carouselthumbs li:nth-child("+a+") a").addClass("active")});$(".carousel.feed").carousel();$(".carousel.feed").carousel("pause")},manage:function(){var a=OP.Batch.collection.getAll(),b=OP.Batch.collection.getLength(),c=$(".pin"),d,e;0<b&&opTheme.ui.batchMessage();c.each(function(b,c){c=$(c);d=c.attr("class");e=d.match(/ photo-([a-z0-9]+)/);2==e.length&&void 0!==a[e[1]]&&c.addClass("revealed pinned")})},photo:{init:function(){j.fetchAndCacheNextPrevious()}},photos:{page:null,pageCount:0,end:!1,
running:!1,init:function(){var a=opTheme.init.pages.photos;$(window).scroll(a.scrollCb);a.load()},scrollCb:function(){var a=opTheme.init.pages.photos;$(window).scrollTop()>$(document).height()-$(window).height()-200&&a.load()},load:function(){var a=opTheme.init.pages.photos;loc=location;if(!a.end&&!a.running){a.running=!0;if(null===a.page){var b=loc.href.match("page=([0-9]+)");null!==b?a.page=b[1]:(b=loc.pathname.match(/\/page-([0-9]+)/),null!==b&&(a.page=b[1]));null===a.page&&(a.page=1)}b=location.pathname+
".json";params={};qs=window.location.search.replace("?","");if(0<qs.length){var c=qs.split("&"),d;for(i in c)c.hasOwnProperty(i)&&(d=c[i].split("="),2===d.length&&(params[d[0]]=d[1]))}params.returnSizes="960x180";params.page=a.page;$.getJSON(b,params,a.loadCb)}},loadCb:function(a){var a=a.result,b=opTheme.init.pages.photos,c=$(".infobar"),d=$(".startdate",c),c=$(".enddate",c);parseInt(d.attr("data-time"));var e=parseInt(c.attr("data-time")),g=opTheme.ui,f;if(a[0].totalPages>=b.page){var h;for(f=0;f<
a.length;f++)h=parseInt(a[f].dateTaken),h>e?(g.fadeAndSet(c,phpjs.date("l F jS, Y",h)),c.attr("data-time",h),e=h):parseInt(a[f].dateTaken)<parseInt(d.attr("data-time"))&&(g.fadeAndSet(d,phpjs.date("l F jS, Y",h)),d.attr("data-time",h));Gallery.showImages($(".photo-grid-justify"),a);b.page++;b.pageCount++;b.running=!1}else $(".load-more").hide(),b.end=!0}}}},message:{append:function(a){var b=$(".message:first").clone(!1),c=$(".message:last");b.addClass("alert alert-info").html(a);c.after(b).slideDown()},
confirm:function(a){opTheme.message.show(a,"confirm")},error:function(a){opTheme.message.show(a,"error")},show:function(a,b){opTheme.message.append(f.message(a,b))}},ui:{batchFormFields:{empty:function(){return""},groups:function(){var a,b="";$.ajax({url:"/groups/list.json",async:!1,success:function(c){if(200===c.code)for(i in c.result)c.result.hasOwnProperty(i)&&(a=c.result[i],b+='<label class="checkbox inline"><input type="checkbox" name="value" value="'+a.id+'" class="group-checkbox-click group-checkbox">'+
a.name+"</label>")}});return b},permission:function(){return'  <label class="radio">    <input type="radio" name="value" value="1" checked="checked">    Public  </label>  <label class="radio">    <input type="radio" name="value" value="0">     Private  </label>'},tags:function(){return'  <label>Tags</label>  <input type="text" name="value" class="tags-autocomplete" placeholder="A comma separated list of tags" value="">'}},batchMessage:function(){var a=OP.Batch.collection.getLength();0<$("#batch-message").length&&
0<a?$("#batch-count").html(a):0==a?$("#batch-message").parent().parent().slideUp("fast",function(){$(this).html("").removeClass()}):opTheme.message.append(f.message('  <a id="batch-message"></a>You have <span id="batch-count">'+a+'</span> photos pinned.  <div><a class="btn small info batch-modal-click" data-controls-modal="modal" data-backdrop="static">Batch edit</a>&nbsp;<a href="#" class="btn small pin-clear-click">Or clear pins</a></div>'))},fadeAndSet:function(a,b){var c=$(a);c.fadeOut("fast",
function(){c.html(b).fadeIn("fast")})}},user:{base:{loginProcessed:function(a){200!=a.code?g("processing of login failed"):(g("login processing succeeded"),window.location.reload())}},browserid:{loginFailure:function(){g("login failed")},loginSuccess:function(a){OP.Util.makeRequest("/user/browserid/login.json",{assertion:a},opTheme.user.base.loginProcessed)}}}}}();
