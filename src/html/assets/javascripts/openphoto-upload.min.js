(function(){function h(){this.returnValue=!1}function k(){this.cancelBubble=!0}var e=0,s=[],o={},v={},t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g,p=window.setTimeout,q={},l,d="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe".split(/,/),
f,u,c;for(f=0;f<d.length;f+=2){c=d[f+1].split(/ /);for(u=0;u<c.length;u++)v[c[u]]=d[f]}d=navigator;f=d.userAgent;c=d.vendor;var j;j=(u=/WebKit/.test(f))&&-1!==c.indexOf("Apple");c=window.opera&&window.opera.buildNumber;var d={windows:-1!==navigator.platform.indexOf("Win"),ie:!u&&!c&&/MSIE/gi.test(f)&&/Explorer/gi.test(d.appName),webkit:u,gecko:!u&&/Gecko/.test(f),safari:j,opera:!!c},b={VERSION:"@@version@@",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,
IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:v,ua:d,typeOf:function(a){return{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(a){b.each(arguments,function(m,r){0<r&&b.each(m,function(b,m){a[m]=b})});return a},cleanName:function(a){var b,r;r=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,
"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<r.length;b+=2)a=a.replace(r[b],r[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(a,b){b.name=a;s[a]=b;s.push(b);return b},guid:function(){var a=(new Date).getTime().toString(32),m;for(m=0;5>m;m++)a+=Math.floor(65535*Math.random()).toString(32);return(b.guidPrefix||"p")+a+(e++).toString(32)},buildUrl:function(a,
m){var r="";b.each(m,function(a,b){r+=(r?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)});r&&(a+=(0<a.indexOf("?")?"&":"?")+r);return a},each:function(a,b){var r,g;if(a)if(r=a.length,void 0===r)for(g in a){if(a.hasOwnProperty(g)&&!1===b(a[g],g))break}else for(g=0;g<r&&!1!==b(a[g],g);g++);},formatSize:function(a){return void 0===a||/\D/.test(a)?b.translate("N/A"):1073741824<a?Math.round(a/1073741824,1)+" GB":1048576<a?Math.round(a/1048576,1)+" MB":1024<a?Math.round(a/1024,1)+" KB":a+" b"},
getPos:function(a,b){function r(a){var b,m=0;b=0;a&&(b=a.getBoundingClientRect(),a="CSS1Compat"===d.compatMode?d.documentElement:d.body,m=b.left+a.scrollLeft,b=b.top+a.scrollTop);return{x:m,y:b}}var g=0,j=0,c,d=document,b=b||d.body;if(a&&a.getBoundingClientRect&&0<navigator.userAgent.indexOf("MSIE")&&8!==d.documentMode)return g=r(a),j=r(b),{x:g.x-j.x,y:g.y-j.y};for(c=a;c&&c!=b&&c.nodeType;)g+=c.offsetLeft||0,j+=c.offsetTop||0,c=c.offsetParent;for(c=a.parentNode;c&&c!=b&&c.nodeType;)g-=c.scrollLeft||
0,j-=c.scrollTop||0,c=c.parentNode;return{x:g,y:j}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}},parseSize:function(a){var b;"string"==typeof a&&(a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),b=a[2],a=+a[1],"g"==b&&(a*=1073741824),"m"==b&&(a*=1048576),"k"==b&&(a*=1024));return a},xmlEncode:function(a){return a?(""+a).replace(n,function(a){return t[a]?"&"+t[a]+";":a}):a},toArray:function(a){var b,r=[];for(b=0;b<a.length;b++)r[b]=
a[b];return r},inArray:function(a,b){if(b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(b,a);for(var r=0,g=b.length;r<g;r++)if(b[r]===a)return r}return-1},addI18n:function(a){return b.extend(o,a)},translate:function(a){return o[a]||a},isEmptyObj:function(a){if(void 0===a)return!0;for(var b in a)return!1;return!0},hasClass:function(a,b){return""==a.className?!1:RegExp("(^|\\s+)"+b+"(\\s+|$)").test(a.className)},addClass:function(a,m){b.hasClass(a,m)||(a.className=""==a.className?
m:a.className.replace(/\s+$/,"")+" "+m)},removeClass:function(a,b){a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)"),function(a,b,m){return" "===b&&" "===m?" ":""})},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},addEvent:function(a,m,r,g){var c,m=m.toLowerCase();void 0===l&&(l="Plupload_"+b.guid());a.addEventListener?(c=r,a.addEventListener(m,c,!1)):a.attachEvent&&(c=function(){var a=window.event;
a.target||(a.target=a.srcElement);a.preventDefault=h;a.stopPropagation=k;r(a)},a.attachEvent("on"+m,c));void 0===a[l]&&(a[l]=b.guid());q.hasOwnProperty(a[l])||(q[a[l]]={});a=q[a[l]];a.hasOwnProperty(m)||(a[m]=[]);a[m].push({func:c,orig:r,key:g})},removeEvent:function(a,m,c){var g,j;"function"==typeof c?g=c:j=c;m=m.toLowerCase();if(a[l]&&q[a[l]]&&q[a[l]][m]){for(var c=q[a[l]][m],d=c.length-1;0<=d;d--)if(c[d].key===j||c[d].orig===g)if(a.detachEvent?a.detachEvent("on"+m,c[d].func):a.removeEventListener&&
a.removeEventListener(m,c[d].func,!1),c[d].orig=null,c[d].func=null,c.splice(d,1),void 0!==g)break;c.length||delete q[a[l]][m];if(b.isEmptyObj(q[a[l]])){delete q[a[l]];try{delete a[l]}catch(f){a[l]=void 0}}}},removeAllEvents:function(a,c){void 0!==a[l]&&a[l]&&b.each(q[a[l]],function(j,g){b.removeEvent(a,g,c)})},Uploader:function(a){function c(){var a,d=0,j;if(this.state==b.STARTED){f=this.files;for(j=0;j<f.length;j++)!a&&f[j].status==b.QUEUED?(a=f[j],a.status=b.UPLOADING,this.trigger("BeforeUpload",
a)&&this.trigger("UploadFile",a)):d++;d==f.length&&(this.stop(),this.trigger("UploadComplete",f))}}function j(){var a,c;d.reset();for(a=0;a<f.length;a++)c=f[a],void 0!==c.size?(d.size+=c.size,d.loaded+=c.loaded):d.size=void 0,c.status==b.DONE?d.uploaded++:c.status==b.FAILED?d.failed++:d.queued++;void 0===d.size?d.percent=0<f.length?Math.ceil(100*(d.uploaded/f.length)):0:(d.bytesPerSec=Math.ceil(d.loaded/((+new Date-e||1)/1E3)),d.percent=0<d.size?Math.ceil(100*(d.loaded/d.size)):0)}var g={},d,f=[],
e,u=!1;d=new b.QueueProgress;a=b.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},a);b.extend(this,{state:b.STOPPED,runtime:"",features:{},files:f,settings:a,total:d,id:b.guid(),init:function(){function d(){var a=h[k++],c,j,m;if(a){c=a.getFeatures();if(j=g.settings.required_features){j=j.split(",");for(m=0;m<j.length;m++)if(!c[j[m]]){d();return}}a.init(g,function(b){b&&b.success?(g.features=c,g.runtime=a.name,g.trigger("Init",{runtime:a.name}),g.trigger("PostInit"),
g.refresh()):d()})}else g.trigger("Error",{code:b.INIT_ERROR,message:b.translate("Init error.")})}var g=this,u,h,k=0,l;"function"==typeof a.preinit?a.preinit(g):b.each(a.preinit,function(a,b){g.bind(b,a)});a.page_url=a.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");/^(\w+:\/\/|\/)/.test(a.url)||(a.url=a.page_url+a.url);a.chunk_size=b.parseSize(a.chunk_size);a.max_file_size=b.parseSize(a.max_file_size);g.bind("FilesAdded",function(c,d){var j,m,r=0,e;if((j=a.filters)&&j.length){e=[];
b.each(j,function(a){b.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?e.push("\\.*"):e.push("\\."+a.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})});e=RegExp(e.join("|")+"$","i")}for(j=0;j<d.length;j++){m=d[j];m.loaded=0;m.percent=0;m.status=b.QUEUED;if(e&&!e.test(m.name))c.trigger("Error",{code:b.FILE_EXTENSION_ERROR,message:b.translate("File extension error."),file:m});else if(m.size!==void 0&&m.size>a.max_file_size)c.trigger("Error",{code:b.FILE_SIZE_ERROR,
message:b.translate("File size error."),file:m});else{f.push(m);r++}}if(r)p(function(){g.trigger("QueueChanged");g.refresh()},1);else return false});a.unique_names&&g.bind("UploadFile",function(a,b){var c=b.name.match(/\.([^.]+)$/),d="tmp";c&&(d=c[1]);b.target_name=b.id+"."+d});g.bind("UploadProgress",function(a,b){b.percent=b.size>0?Math.ceil(b.loaded/b.size*100):100;j()});g.bind("StateChanged",function(a){if(a.state==b.STARTED)e=+new Date;else if(a.state==b.STOPPED)for(u=a.files.length-1;u>=0;u--)if(a.files[u].status==
b.UPLOADING){a.files[u].status=b.QUEUED;j()}});g.bind("QueueChanged",j);g.bind("Error",function(a,d){if(d.file){d.file.status=b.FAILED;j();a.state==b.STARTED&&p(function(){c.call(g)},1)}});g.bind("FileUploaded",function(a,d){d.status=b.DONE;d.loaded=d.size;a.trigger("UploadProgress",d);p(function(){c.call(g)},1)});if(a.runtimes){h=[];l=a.runtimes.split(/\s?,\s?/);for(u=0;u<l.length;u++)s[l[u]]&&h.push(s[l[u]])}else h=s;d();"function"==typeof a.init?a.init(g):b.each(a.init,function(a,b){g.bind(b,a)})},
refresh:function(){this.trigger("Refresh")},start:function(){this.state!=b.STARTED&&(this.state=b.STARTED,this.trigger("StateChanged"),c.call(this))},stop:function(){this.state!=b.STOPPED&&(this.state=b.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(a){u=void 0!==a?a:!0;this.trigger("DisableBrowse",u)},getFile:function(a){var b;for(b=f.length-1;0<=b;b--)if(f[b].id===a)return f[b]},removeFile:function(a){var b;for(b=f.length-1;0<=b;b--)if(f[b].id===a.id)return this.splice(b,
1)[0]},splice:function(a,b){var c;c=f.splice(void 0===a?0:a,void 0===b?f.length:b);this.trigger("FilesRemoved",c);this.trigger("QueueChanged");return c},trigger:function(a){var b=g[a.toLowerCase()],c,d;if(b){d=Array.prototype.slice.call(arguments);d[0]=this;for(c=0;c<b.length;c++)if(!1===b[c].func.apply(b[c].scope,d))return!1}return!0},hasEventListener:function(a){return!!g[a.toLowerCase()]},bind:function(a,b,c){var d,a=a.toLowerCase();d=g[a]||[];d.push({func:b,scope:c||this});g[a]=d},unbind:function(a,
b){var a=a.toLowerCase(),c=g[a],d;if(c){if(void 0!==b)for(d=c.length-1;0<=d;d--){if(c[d].func===b){c.splice(d,1);break}}else c=[];c.length||delete g[a]}},unbindAll:function(){var a=this;b.each(g,function(b,c){a.unbind(c)})},destroy:function(){this.stop();this.trigger("Destroy");this.unbindAll()}})},File:function(a,b,c){this.id=a;this.name=b;this.size=c;this.status=this.percent=this.loaded=0},Runtime:function(){this.getFeatures=function(){};this.init=function(){}},QueueProgress:function(){var a=this;
a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},runtimes:{}};window.plupload=b})();
(function(h,k,e,s){function o(d,f){var e;if("FileReader"in h)e=new FileReader,e.readAsBinaryString(d),e.onload=function(){f(e.result)};else return f(d.getAsBinary())}function v(d,f,e,c){var j,b,a,m,r=this;var g=q[d.id],l=function(g){j=k.createElement("canvas");j.style.display="none";k.body.appendChild(j);b=j.getContext("2d");a=new Image;a.onerror=a.onabort=function(){c({success:!1})};a.onload=function(){var h,l,k,o;f.width||(f.width=a.width);f.height||(f.height=a.height);m=Math.min(f.width/a.width,
f.height/a.height);if(1>m||1===m&&"image/jpeg"===e){h=Math.round(a.width*m);l=Math.round(a.height*m);j.width=h;j.height=l;b.drawImage(a,0,0,h,l);if("image/jpeg"===e){if(k=new n(atob(g.substring(g.indexOf("base64,")+7))),k.headers&&k.headers.length&&(o=new p,o.init(k.get("exif")[0])&&(o.setExif("PixelXDimension",h),o.setExif("PixelYDimension",l),k.set("exif",o.getBinary()),r.hasEventListener("ExifData")&&r.trigger("ExifData",d,o.EXIF()),r.hasEventListener("GpsData")&&r.trigger("GpsData",d,o.GPS()))),
f.quality)try{g=j.toDataURL(e,f.quality/100)}catch(q){g=j.toDataURL(e)}}else g=j.toDataURL(e);g=g.substring(g.indexOf("base64,")+7);g=atob(g);k&&(k.headers&&k.headers.length)&&(g=k.restore(g),k.purge());j.parentNode.removeChild(j);c({success:!0,data:g})}else c({success:!1})};a.src=g},o;"FileReader"in h?(o=new FileReader,o.readAsDataURL(g),o.onload=function(){l(o.result)}):l(g.getAsDataURL())}function t(){function d(d,b){var a=e?0:-8*(b-1),m=0,f;for(f=0;f<b;f++)m|=c.charCodeAt(d+f)<<Math.abs(a+8*f);
return m}function f(d,b,a){a=3===arguments.length?a:c.length-b-1;c=c.substr(0,b)+d+c.substr(a+b)}var e=!1,c;return{II:function(c){if(c===s)return e;e=c},init:function(d){e=!1;c=d},SEGMENT:function(d,b,a){switch(arguments.length){case 1:return c.substr(d,c.length-d-1);case 2:return c.substr(d,b);case 3:f(a,d,b);break;default:return c}},BYTE:function(c){return d(c,1)},SHORT:function(c){return d(c,2)},LONG:function(c,b){if(b===s)return d(c,4);var a="",m=e?0:-24,r;for(r=0;4>r;r++)a+=String.fromCharCode(b>>
Math.abs(m+8*r)&255);f(a,c,4)},SLONG:function(c){c=d(c,4);return 2147483647<c?c-4294967296:c},STRING:function(c,b){for(var a="",b=b+c;c<b;c++)a+=String.fromCharCode(d(c,1));return a}}}function n(d){var f={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},e=[],c,j,b=s,a=0;c=new t;c.init(d);if(65496===c.SHORT(0)){j=2;for(d=Math.min(1048576,d.length);j<=d;)if(b=c.SHORT(j),65488<=
b&&65495>=b)j+=2;else{if(65498===b||65497===b)break;a=c.SHORT(j+2)+2;f[b]&&c.STRING(j+4,f[b].signature.length)===f[b].signature&&e.push({hex:b,app:f[b].app.toUpperCase(),name:f[b].name.toUpperCase(),start:j,length:a,segment:c.SEGMENT(j,a)});j+=a}c.init(null);return{headers:e,restore:function(a){c.init(a);var b=new n(a);if(!b.headers)return!1;for(a=b.headers.length;0<a;a--){var d=b.headers[a-1];c.SEGMENT(d.start,d.length,"")}b.purge();j=65504==c.SHORT(2)?4+c.SHORT(4):2;a=0;for(b=e.length;a<b;a++)c.SEGMENT(j,
0,e[a].segment),j+=e[a].length;return c.SEGMENT()},get:function(a){for(var b=[],c=0,d=e.length;c<d;c++)e[c].app===a.toUpperCase()&&b.push(e[c].segment);return b},set:function(a,b){var c=[];"string"===typeof b?c.push(b):c=b;for(var d=ii=0,f=e.length;d<f&&!(e[d].app===a.toUpperCase()&&(e[d].segment=c[ii],e[d].length=c[ii].length,ii++),ii>=c.length);d++);},purge:function(){e=[];c.init(null)}}}}function p(){function d(b,a){var d=f.SHORT(b),e,g,h,k,l,o=[],n={};for(e=0;e<d;e++)if(l=b+12*e+2,h=a[f.SHORT(l)],
h!==s){g=f.SHORT(l+=2);k=f.LONG(l+=2);l+=4;o=[];switch(g){case 1:case 7:4<k&&(l=f.LONG(l)+c.tiffHeader);for(g=0;g<k;g++)o[g]=f.BYTE(l+g);break;case 2:4<k&&(l=f.LONG(l)+c.tiffHeader);n[h]=f.STRING(l,k-1);continue;case 3:2<k&&(l=f.LONG(l)+c.tiffHeader);for(g=0;g<k;g++)o[g]=f.SHORT(l+2*g);break;case 4:1<k&&(l=f.LONG(l)+c.tiffHeader);for(g=0;g<k;g++)o[g]=f.LONG(l+4*g);break;case 5:l=f.LONG(l)+c.tiffHeader;for(g=0;g<k;g++)o[g]=f.LONG(l+4*g)/f.LONG(l+4*g+4);break;case 9:l=f.LONG(l)+c.tiffHeader;for(g=0;g<
k;g++)o[g]=f.SLONG(l+4*g);break;case 10:l=f.LONG(l)+c.tiffHeader;for(g=0;g<k;g++)o[g]=f.SLONG(l+4*g)/f.SLONG(l+4*g+4);break;default:continue}k=1==k?o[0]:o;n[h]=j.hasOwnProperty(h)&&"object"!=typeof k?j[h][k]:k}return n}var f,h,c={},j;f=new t;h={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",
37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{"0":"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};j={ColorSpace:{1:"sRGB","0":"Uncalibrated"},MeteringMode:{"0":"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",
2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{"0":"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",
9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
ExposureMode:{"0":"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{"0":"Auto white balance",1:"Manual white balance"},SceneCaptureType:{"0":"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{"0":"Normal",1:"Soft",2:"Hard"},Saturation:{"0":"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{"0":"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(b){c=
{tiffHeader:10};if(b===s||!b.length)return!1;f.init(b);return 65505===f.SHORT(0)&&"EXIF\x00"===f.STRING(4,5).toUpperCase()?(b=s,b=c.tiffHeader,f.II(18761==f.SHORT(b)),42!==f.SHORT(b+=2)?b=!1:(c.IFD0=c.tiffHeader+f.LONG(b+2),b=d(c.IFD0,h.tiff),c.exifIFD="ExifIFDPointer"in b?c.tiffHeader+b.ExifIFDPointer:s,c.gpsIFD="GPSInfoIFDPointer"in b?c.tiffHeader+b.GPSInfoIFDPointer:s,b=!0),b):!1},EXIF:function(){var b;b=d(c.exifIFD,h.exif);if(b.ExifVersion&&"array"===e.typeOf(b.ExifVersion)){for(var a=0,f="";a<
b.ExifVersion.length;a++)f+=String.fromCharCode(b.ExifVersion[a]);b.ExifVersion=f}return b},GPS:function(){var b;b=d(c.gpsIFD,h.gps);b.GPSVersionID&&(b.GPSVersionID=b.GPSVersionID.join("."));return b},setExif:function(b,a){if("PixelXDimension"!==b&&"PixelYDimension"!==b)return!1;var d;d=b;var e,g,j,l=0;if("string"===typeof d)for(hex in e=h.exif,e)if(e[hex]===d){d=hex;break}e=c.exifIFD;g=f.SHORT(e);for(i=0;i<g;i++)if(j=e+12*i+2,f.SHORT(j)==d){l=j+8;break}l?(f.LONG(l,a),d=!0):d=!1;return d},getBinary:function(){return f.SEGMENT()}}}
var q={},l;e.runtimes.Html5=e.addRuntime("html5",{getFeatures:function(){var d,f,o,c,j,b;f=o=j=b=!1;h.XMLHttpRequest&&(d=new XMLHttpRequest,o=!!d.upload,f=!(!d.sendAsBinary&&!d.upload));f&&(c=!!(d.sendAsBinary||h.Uint8Array&&h.ArrayBuffer),j=!(!File||!File.prototype.getAsDataURL&&!h.FileReader||!c),b=!(!File||!File.prototype.mozSlice&&!File.prototype.webkitSlice&&!File.prototype.slice));l=e.ua.safari&&e.ua.windows;d=f;f=k.createElement("div");return{html5:d,dragdrop:"draggable"in f||"ondragstart"in
f&&"ondrop"in f,jpgresize:j,pngresize:j,multipart:j||!!h.FileReader||!!h.FormData,canSendBinary:c,cantSendBlobInFormData:!(!e.ua.gecko||!h.FormData||!h.FileReader||FileReader.prototype.readAsArrayBuffer),progress:o,chunks:b,multi_selection:!(e.ua.safari&&e.ua.windows),triggerDialog:e.ua.gecko&&h.FormData||e.ua.webkit}},init:function(d,f){function n(b){var a,c,f=[],g,j={};for(c=0;c<b.length;c++)a=b[c],j[a.name]||(j[a.name]=!0,g=e.guid(),q[g]=a,f.push(new e.File(g,a.fileName||a.name,a.fileSize||a.size)));
f.length&&d.trigger("FilesAdded",f)}var c,j;c=this.getFeatures();c.html5?(d.bind("Init",function(b){var a,c,f=[],g,j,l=b.settings.filters,h,o;g=k.body;a=k.createElement("div");a.id=b.id+"_html5_container";e.extend(a.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:d.settings.shim_bgcolor?"":0});a.className="plupload html5";d.settings.container&&(g=k.getElementById(d.settings.container),"static"===e.getStyle(g,
"position")&&(g.style.position="relative"));g.appendChild(a);g=0;a:for(;g<l.length;g++){h=l[g].extensions.split(/,/);for(j=0;j<h.length;j++){if("*"===h[j]){f=[];break a}(o=e.mimeTypes[h[j]])&&-1===e.inArray(o,f)&&f.push(o)}}a.innerHTML='<input id="'+d.id+'_html5"  style="font-size:999px" type="file" accept="'+f.join(",")+'" '+(d.settings.multi_selection&&d.features.multi_selection?'multiple="multiple"':"")+" />";a.scrollTop=100;f=k.getElementById(d.id+"_html5");b.features.triggerDialog?e.extend(f.style,
{position:"absolute",width:"100%",height:"100%"}):e.extend(f.style,{cssFloat:"right",styleFloat:"right"});f.onchange=function(){n(this.files);this.value=""};if(c=k.getElementById(b.settings.browse_button)){var p=b.settings.browse_button_hover,q=b.settings.browse_button_active;a=b.features.triggerDialog?c:a;p&&(e.addEvent(a,"mouseover",function(){e.addClass(c,p)},b.id),e.addEvent(a,"mouseout",function(){e.removeClass(c,p)},b.id));q&&(e.addEvent(a,"mousedown",function(){e.addClass(c,q)},b.id),e.addEvent(k.body,
"mouseup",function(){e.removeClass(c,q)},b.id));b.features.triggerDialog&&e.addEvent(c,"click",function(a){var c=k.getElementById(b.id+"_html5");c&&!c.disabled&&c.click();a.preventDefault()},b.id)}}),d.bind("PostInit",function(){var b=k.getElementById(d.settings.drop_element);b&&(l?e.addEvent(b,"dragenter",function(){var a,c;a=k.getElementById(d.id+"_drop");a||(a=k.createElement("input"),a.setAttribute("type","file"),a.setAttribute("id",d.id+"_drop"),a.setAttribute("multiple","multiple"),e.addEvent(a,
"change",function(){n(this.files);e.removeEvent(a,"change",d.id);a.parentNode.removeChild(a)},d.id),b.appendChild(a));e.getPos(b,k.getElementById(d.settings.container));c=e.getSize(b);"static"===e.getStyle(b,"position")&&e.extend(b.style,{position:"relative"});e.extend(a.style,{position:"absolute",display:"block",top:0,left:0,width:c.w+"px",height:c.h+"px",opacity:0})},d.id):(e.addEvent(b,"dragover",function(a){a.preventDefault()},d.id),e.addEvent(b,"drop",function(a){var b=a.dataTransfer;b&&b.files&&
n(b.files);a.preventDefault()},d.id)))}),d.bind("Refresh",function(b){var a,c,f;if(a=k.getElementById(d.settings.browse_button))c=e.getPos(a,k.getElementById(b.settings.container)),f=e.getSize(a),b=k.getElementById(d.id+"_html5_container"),e.extend(b.style,{top:c.y+"px",left:c.x+"px",width:f.w+"px",height:f.h+"px"}),d.features.triggerDialog&&("static"===e.getStyle(a,"position")&&e.extend(a.style,{position:"relative"}),c=parseInt(e.getStyle(a,"z-index"),10),isNaN(c)&&(c=0),e.extend(a.style,{zIndex:c}),
e.extend(b.style,{zIndex:c-1}))}),d.bind("DisableBrowse",function(b,a){var c=k.getElementById(b.id+"_html5");c&&(c.disabled=a)}),d.bind("CancelUpload",function(){j.abort&&j.abort()}),d.bind("UploadFile",function(b,a){function d(g){function l(){function d(f){var g=0,o="----pluploadboundary"+e.guid(),r,x="";j=new XMLHttpRequest;j.upload&&(j.upload.onprogress=function(c){a.loaded=Math.min(a.size,m+c.loaded-g);b.trigger("UploadProgress",a)});j.onreadystatechange=function(){var c,d;if(j.readyState==4&&
b.state!==e.STOPPED){try{c=j.status}catch(g){c=0}if(c>=400)b.trigger("Error",{code:e.HTTP_ERROR,message:e.translate("HTTP Error."),file:a,status:c});else{if(p){d={chunk:k,chunks:p,response:j.responseText,status:c};b.trigger("ChunkUploaded",a,d);m=m+s;if(d.cancelled){a.status=e.FAILED;return}a.loaded=Math.min(a.size,(k+1)*v)}else a.loaded=a.size;b.trigger("UploadProgress",a);f=n=r=x=null;if(!p||++k>=p){a.status=e.DONE;b.trigger("FileUploaded",a,{response:j.responseText,status:c})}else l()}}};if(b.settings.multipart&&
c.multipart){q.name=a.target_name||a.name;j.open("post",t,!0);e.each(b.settings.headers,function(a,b){j.setRequestHeader(b,a)});if("string"!==typeof f&&h.FormData){r=new FormData;e.each(e.extend(q,b.settings.multipart_params),function(a,b){r.append(b,a)});r.append(b.settings.file_data_name,f);j.send(r);return}if("string"===typeof f){j.setRequestHeader("Content-Type","multipart/form-data; boundary="+o);e.each(e.extend(q,b.settings.multipart_params),function(a,b){x=x+("--"+o+'\r\nContent-Disposition: form-data; name="'+
b+'"\r\n\r\n');x=x+(unescape(encodeURIComponent(a))+"\r\n")});u=e.mimeTypes[a.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";x+="--"+o+'\r\nContent-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(a.name))+'"\r\nContent-Type: '+u+"\r\n\r\n"+f+"\r\n--"+o+"--\r\n";g=x.length-f.length;f=x;if(j.sendAsBinary)j.sendAsBinary(f);else if(c.canSendBinary){for(var y=new Uint8Array(f.length),w=0;w<f.length;w++)y[w]=f.charCodeAt(w)&
255;j.send(y.buffer)}return}}t=e.buildUrl(b.settings.url,e.extend(q,b.settings.multipart_params));j.open("post",t,!0);j.setRequestHeader("Content-Type","application/octet-stream");e.each(b.settings.headers,function(a,b){j.setRequestHeader(b,a)});j.send(f)}var n,p,q,v,s,u,t=b.settings.url;if(!(a.status==e.DONE||a.status==e.FAILED||b.state==e.STOPPED)){q={name:a.target_name||a.name};if(f.chunk_size&&a.size>f.chunk_size&&(c.chunks||"string"==typeof g)){v=f.chunk_size;p=Math.ceil(a.size/v);s=Math.min(v,
a.size-k*v);if("string"==typeof g)n=g.substring(k*v,k*v+s);else{var y=g,w=k*v,z=k*v+s,A;if(File.prototype.slice)try{y.slice(),n=y.slice(w,z)}catch(B){n=y.slice(w,z-w)}else n=(A=File.prototype.webkitSlice||File.prototype.mozSlice)?A.call(y,w,z):null}q.chunk=k;q.chunks=p}else s=a.size,n=g;b.settings.multipart&&c.multipart&&"string"!==typeof n&&o&&c.cantSendBlobInFormData&&c.chunks&&b.settings.chunk_size?(o.onload=function(){d(o.result)},o.readAsBinaryString(n)):d(n)}}var k=0,m=0,o="FileReader"in h?
new FileReader:null;l()}var f=b.settings,g;g=q[a.id];c.jpgresize&&b.settings.resize&&/\.(png|jpg|jpeg)$/i.test(a.name)?v.call(b,a,b.settings.resize,/\.png$/i.test(a.name)?"image/png":"image/jpeg",function(b){b.success?(a.size=b.data.length,d(b.data)):c.chunks?d(g):o(g,d)}):!c.chunks&&c.jpgresize?o(g,d):d(g)}),d.bind("Destroy",function(b){var a,c,d=k.body,f={inputContainer:b.id+"_html5_container",inputFile:b.id+"_html5",browseButton:b.settings.browse_button,dropElm:b.settings.drop_element};for(a in f)(c=
k.getElementById(f[a]))&&e.removeAllEvents(c,b.id);e.removeAllEvents(k.body,b.id);b.settings.container&&(d=k.getElementById(b.settings.container));d.removeChild(k.getElementById(f.inputContainer))}),f({success:!0})):f({success:!1})}})})(window,document,plupload);
(function(h){function k(e){return plupload.translate(e)||e}var e={};h.fn.pluploadQueue=function(s){return s?(this.each(function(){function o(e){var d;e.status==plupload.DONE&&(d="plupload_done");e.status==plupload.FAILED&&(d="plupload_failed");e.status==plupload.QUEUED&&(d="plupload_delete");e.status==plupload.UPLOADING&&(d="plupload_uploading");d=h("#"+e.id).attr("class",d).find("a").css("display","block");e.hint&&d.attr("title",e.hint)}function v(){h("span.plupload_total_status",p).html(n.total.percent+
"%");h("div.plupload_progress_bar",p).css("width",n.total.percent+"%");h("span.plupload_upload_status",p).text(k("Uploaded %d/%d files").replace(/%d\/%d/,n.total.uploaded+"/"+n.files.length))}function t(){var e=h("ul.plupload_filelist",p).html(""),d=0,f;h.each(n.files,function(k,c){f="";c.status==plupload.DONE&&(c.target_name&&(f+='<input type="hidden" name="'+q+"_"+d+'_tmpname" value="'+plupload.xmlEncode(c.target_name)+'" />'),f+='<input type="hidden" name="'+q+"_"+d+'_name" value="'+plupload.xmlEncode(c.name)+
'" />',f+='<input type="hidden" name="'+q+"_"+d+'_status" value="'+(c.status==plupload.DONE?"done":"failed")+'" />',d++,h("#"+q+"_count").val(d));e.append('<li id="'+c.id+'"><div class="plupload_file_name"><span>'+c.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+c.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(c.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+f+"</li>");o(c);h("#"+c.id+".plupload_delete a").click(function(d){h("#"+
c.id).remove();n.removeFile(c);d.preventDefault()})});h("span.plupload_total_file_size",p).html(plupload.formatSize(n.total.size));0===n.total.queued?h("span.plupload_add_text",p).text(k("Add photos.")):h("span.plupload_add_text",p).text(n.total.queued+" photos queued.");h("a.plupload_start",p).toggleClass("plupload_disabled",n.files.length==n.total.uploaded+n.total.failed);e[0].scrollTop=e[0].scrollHeight;v();(s.keep_droptext||!n.files.length&&n.features.dragdrop&&n.settings.dragdrop)&&h("#"+q+"_filelist").append('<li class="plupload_droptext">'+
k("Drag photos here.")+"</li>")}var n,p,q;p=h(this);q=p.attr("id");q||(q=plupload.guid(),p.attr("id",q));n=new plupload.Uploader(h.extend({dragdrop:!0,container:q},s));e[q]=n;n.bind("UploadFile",function(e,d){h("#"+d.id).addClass("plupload_current_file")});n.bind("Init",function(e,d){var f=q,o=p;o.contents().each(function(c,d){d=h(d);d.is(".plupload")||d.remove()});o.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+f+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+
k("Select photos")+'</div><div class="plupload_header_text">'+k("Add photos to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add">'+k("Add photos")+'</a><a href="#" class="plupload_button plupload_start">'+k("Start upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div><div class="plupload_filelist_header"><div class="plupload_file_name">'+
k("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+k("Status")+'</span></div><div class="plupload_file_size">'+k("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+f+'_filelist" class="plupload_filelist"></ul></div></div></div><input type="hidden" id="'+f+'_count" name="'+f+'_count" value="0" /></div>');!s.unique_names&&s.rename&&h("#"+q+"_filelist div.plupload_file_name span",p).live("click",function(c){var d=h(c.target),
b,a,f="";b=e.getFile(d.parents("li")[0].id);a=b.name;if(c=/^(.+)(\.[^.]+)$/.exec(a)){a=c[1];f=c[2]}d.hide().after('<input type="text" />');d.next().val(a).focus().blur(function(){d.show().next().remove()}).keydown(function(a){var c=h(this);if(a.keyCode==13){a.preventDefault();b.name=c.val()+f;d.text(b.name);c.blur()}})});h("a.plupload_add",p).attr("id",q+"_browse");e.settings.browse_button=q+"_browse";if(e.features.dragdrop&&e.settings.dragdrop){e.settings.drop_element=q+"_filelist";h("#"+q+"_filelist").append('<li class="plupload_droptext">'+
k("Drag photos here.")+"</li>")}h("#"+q+"_container").attr("title","Using runtime: "+d.runtime);h("a.plupload_start",p).click(function(c){h(this).hasClass("plupload_disabled")||n.start();c.preventDefault()});h("a.plupload_stop",p).click(function(c){c.preventDefault();n.stop()});h("a.plupload_start",p).addClass("plupload_disabled")});n.init();n.bind("Error",function(e,d){var f=d.file,o;if(f){o=d.message;d.details&&(o=o+(" ("+d.details+")"));d.code==plupload.FILE_SIZE_ERROR&&alert(k("Error: File too large: ")+
f.name);d.code==plupload.FILE_EXTENSION_ERROR&&alert(k("Error: Invalid file extension: ")+f.name);f.hint=o;h("#"+f.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",o)}});n.bind("StateChanged",function(){if(n.state===plupload.STARTED){h("li.plupload_delete a,div.plupload_buttons",p).hide();h("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",p).css("display","block");h("span.plupload_upload_status",p).text("Uploaded "+n.total.uploaded+"/"+n.files.length+
" files");s.multiple_queues&&h("span.plupload_total_status,span.plupload_total_file_size",p).show()}else{t();h("a.plupload_stop,div.plupload_progress",p).hide();h("a.plupload_delete",p).css("display","block")}});n.bind("QueueChanged",t);n.bind("FileUploaded",function(e,d){o(d)});n.bind("UploadProgress",function(e,d){h("#"+d.id+" div.plupload_file_status",p).html(d.percent+"%");o(d);v();if(s.multiple_queues&&n.total.uploaded+n.total.failed==n.files.length){h(".plupload_buttons,.plupload_upload_status",
p).css("display","inline");h(".plupload_start",p).addClass("plupload_disabled");h("span.plupload_total_status,span.plupload_total_file_size",p).hide()}});s.setup&&s.setup(n)}),this):e[h(this[0]).attr("id")]}})(jQuery);
OPU=function(){var h=function(e,k){var h=e.name,t=k.name;return h<t?-1:h>t?1:0},k={success:[],failure:[],duplicate:[],ids:[]},e=function(e){"undefined"!==typeof console&&"undefined"!==typeof console.log&&console.log(e)};return{init:function(){if("undefined"!==typeof plupload){var s=$("#uploader");0!=s.length&&("undefined"==typeof s.pluploadQueue?$("#uploader .insufficient").show():(s.pluploadQueue({runtimes:"html5",url:"/photo/upload.json",max_file_size:"32mb",file_data_name:"photo",unique_names:!0,
keep_droptext:!0,filters:[{title:"Photos",extensions:"jpg,jpeg,gif,png"}],flash_swf_url:"plupload.flash.swf",multipart_params:{crumb:$("form.upload input.crumb").val()},preinit:{BeforeUpload:function(){var e=$("#uploader").pluploadQueue();$(".upload-progress .total").html(e.files.length);$(".upload-progress .completed").html(e.total.uploaded+1);$(".upload-progress").slideDown("fast")},Error:function(e,h){opTheme.message.error("Uh oh, we encountered a problem. ("+h.message+")");return!1},FilesAdded:function(e,
k){var t=e.files.concat(k);t.sort(h);e.files=t},FileUploaded:function(h,v,t){t=$.parseJSON(t.response);h=t.code;t=t.result;201===h?(e("Successfully uploaded "+v.name+" at "+t.url),k.success.push(t),k.ids.push(t.id)):409===h?(e("Detected a duplicate of "+v.name),k.duplicate.push(t),k.ids.push(t.id)):(e("Unable to upload "+v.name),k.failure.push(v.name))},UploadComplete:function(e,h){var t,n,p=0,q=0;for(t in h)h.hasOwnProperty(t)&&(q++,n=h[t],n.status!==plupload.DONE&&p++);OP.Util.fire("upload:complete-success",
k)},UploadFile:function(){var e=$("#uploader").pluploadQueue(),h=$("form.upload"),k=$("select[name='license'] :selected",h).val(),n=$("input[name='permission']:checked",h).val(),p=$("select[name='albums']",h).val(),q=$("input[name='tags']",h).val(),l=$("input[name='crumb']",h).val(),h=$("select[name='groups']",h).val();"undefined"===typeof p?p="":null!==p&&(p=p.join(","));"undefined"===typeof h?greoups="":null!==h&&(h=h.join(","));e.settings.multipart_params.license=k;e.settings.multipart_params.tags=
q;e.settings.multipart_params.permission=n;e.settings.multipart_params.albums=p;e.settings.multipart_params.groups=h;e.settings.multipart_params.crumb=l}}}),OP.Util.on("submit:photo-upload",function(e){e.preventDefault();e=$("#uploader").pluploadQueue();"undefined"!=typeof e.files&&0<e.files.length?e.start():opTheme.message.error("Please select at least one photo to upload.")})))}}}}();
