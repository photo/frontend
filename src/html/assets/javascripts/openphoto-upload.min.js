(function(){function l(){this.returnValue=false}function h(){this.cancelBubble=true}var j=0,s=[],r={},t={},v={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},u=/[<>&\"\']/g,p=window.setTimeout,o={},m;(function(a){var a=a.split(/,/),b,e,d;for(b=0;b<a.length;b+=2){d=a[b+1].split(/ /);for(e=0;e<d.length;e++)t[d[e]]=a[b]}})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats,docx pptx xlsx,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/html,htm html xhtml,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,text/csv,csv,text/plain,asc txt text diff log,application/octet-stream,exe");
var f={VERSION:"1.5.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t,ua:function(){var a=navigator,b=a.userAgent,e=a.vendor,d,g;g=(d=/WebKit/.test(b))&&e.indexOf("Apple")!==-1;e=window.opera&&window.opera.buildNumber;return{windows:navigator.platform.indexOf("Win")!==
-1,ie:!d&&!e&&/MSIE/gi.test(b)&&/Explorer/gi.test(a.appName),webkit:d,gecko:!d&&/Gecko/.test(b),safari:g,opera:!!e}}(),extend:function(a){f.each(arguments,function(b,e){e>0&&f.each(b,function(b,g){a[g]=b})});return a},cleanName:function(a){var b,e;e=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<e.length;b+=
2)a=a.replace(e[b],e[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(a,b){b.name=a;s[a]=b;s.push(b);return b},guid:function(){var a=(new Date).getTime().toString(32),b;for(b=0;b<5;b++)a+=Math.floor(Math.random()*65535).toString(32);return(f.guidPrefix||"p")+a+(j++).toString(32)},buildUrl:function(a,b){var e="";f.each(b,function(a,g){e+=(e?"&":"")+encodeURIComponent(g)+"="+encodeURIComponent(a)});e&&(a+=(a.indexOf("?")>0?"&":"?")+e);return a},each:function(a,
b){var e,d;if(a)if(e=a.length,e===void 0)for(d in a){if(a.hasOwnProperty(d)&&b(a[d],d)===false)break}else for(d=0;d<e;d++)if(b(a[d],d)===false)break},formatSize:function(a){return a===void 0||/\D/.test(a)?f.translate("N/A"):a>1073741824?Math.round(a/1073741824,1)+" GB":a>1048576?Math.round(a/1048576,1)+" MB":a>1024?Math.round(a/1024,1)+" KB":a+" b"},getPos:function(a,b){function e(a){var c,g=0;c=0;a&&(c=a.getBoundingClientRect(),a=q.compatMode==="CSS1Compat"?q.documentElement:q.body,g=c.left+a.scrollLeft,
c=c.top+a.scrollTop);return{x:g,y:c}}var d=0,g=0,c,q=document,b=b||q.body;if(a&&a.getBoundingClientRect&&navigator.userAgent.indexOf("MSIE")>0&&q.documentMode!==8)return d=e(a),g=e(b),{x:d.x-g.x,y:d.y-g.y};for(c=a;c&&c!=b&&c.nodeType;)d+=c.offsetLeft||0,g+=c.offsetTop||0,c=c.offsetParent;for(c=a.parentNode;c&&c!=b&&c.nodeType;)d-=c.scrollLeft||0,g-=c.scrollTop||0,c=c.parentNode;return{x:d,y:g}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}},parseSize:function(a){var b;
typeof a=="string"&&(a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),b=a[2],a=+a[1],b=="g"&&(a*=1073741824),b=="m"&&(a*=1048576),b=="k"&&(a*=1024));return a},xmlEncode:function(a){return a?(""+a).replace(u,function(a){return v[a]?"&"+v[a]+";":a}):a},toArray:function(a){var b,e=[];for(b=0;b<a.length;b++)e[b]=a[b];return e},addI18n:function(a){return f.extend(r,a)},translate:function(a){return r[a]||a},isEmptyObj:function(a){if(a===void 0)return true;for(var b in a)return false;
return true},hasClass:function(a,b){return a.className==""?false:RegExp("(^|\\s+)"+b+"(\\s+|$)").test(a.className)},addClass:function(a,b){if(!f.hasClass(a,b))a.className=a.className==""?b:a.className.replace(/\s+$/,"")+" "+b},removeClass:function(a,b){a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)"),function(a,b,g){return b===" "&&g===" "?" ":""})},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];else if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},
addEvent:function(a,b,e,d){var g,b=b.toLowerCase();m===void 0&&(m="Plupload_"+f.guid());a.addEventListener?(g=e,a.addEventListener(b,g,false)):a.attachEvent&&(g=function(){var a=window.event;if(!a.target)a.target=a.srcElement;a.preventDefault=l;a.stopPropagation=h;e(a)},a.attachEvent("on"+b,g));a[m]===void 0&&(a[m]=f.guid());o.hasOwnProperty(a[m])||(o[a[m]]={});a=o[a[m]];a.hasOwnProperty(b)||(a[b]=[]);a[b].push({func:g,orig:e,key:d})},removeEvent:function(a,b,e){var d,g;typeof e=="function"?d=e:g=
e;b=b.toLowerCase();if(a[m]&&o[a[m]]&&o[a[m]][b]){for(var e=o[a[m]][b],c=e.length-1;c>=0;c--)if(e[c].key===g||e[c].orig===d)if(a.detachEvent?a.detachEvent("on"+b,e[c].func):a.removeEventListener&&a.removeEventListener(b,e[c].func,false),e[c].orig=null,e[c].func=null,e.splice(c,1),d!==void 0)break;e.length||delete o[a[m]][b];if(f.isEmptyObj(o[a[m]])){delete o[a[m]];try{delete a[m]}catch(q){a[m]=void 0}}}},removeAllEvents:function(a,b){a[m]!==void 0&&a[m]&&f.each(o[a[m]],function(e,d){f.removeEvent(a,
d,b)})}};f.Uploader=function(a){function b(){var a,g=0,b;if(this.state==f.STARTED){for(b=0;b<c.length;b++)!a&&c[b].status==f.QUEUED?(a=c[b],a.status=f.UPLOADING,this.trigger("BeforeUpload",a)&&this.trigger("UploadFile",a)):g++;g==c.length&&(this.stop(),this.trigger("UploadComplete",c))}}function e(){var a,b;g.reset();for(a=0;a<c.length;a++)b=c[a],b.size!==void 0?(g.size+=b.size,g.loaded+=b.loaded):g.size=void 0,b.status==f.DONE?g.uploaded++:b.status==f.FAILED?g.failed++:g.queued++;g.size===void 0?
g.percent=c.length>0?Math.ceil(g.uploaded/c.length*100):0:(g.bytesPerSec=Math.ceil(g.loaded/((+new Date-q||1)/1E3)),g.percent=g.size>0?Math.ceil(g.loaded/g.size*100):0)}var d={},g,c=[],q;g=new f.QueueProgress;a=f.extend({chunk_size:0,multipart:true,multi_selection:true,file_data_name:"photo",filters:[]},a);f.extend(this,{state:f.STOPPED,runtime:"",features:{},files:c,settings:a,total:g,id:f.guid(),init:function(){function g(){var a=j[l++],c,b,e;if(a){c=a.getFeatures();if(b=d.settings.required_features){b=
b.split(",");for(e=0;e<b.length;e++)if(!c[b[e]]){g();return}}a.init(d,function(b){b&&b.success?(d.features=c,d.runtime=a.name,d.trigger("Init",{runtime:a.name}),d.trigger("PostInit"),d.refresh()):g()})}else d.trigger("Error",{code:f.INIT_ERROR,message:f.translate("Init error.")})}var d=this,k,j,l=0,n;typeof a.preinit=="function"?a.preinit(d):f.each(a.preinit,function(a,c){d.bind(c,a)});a.page_url=a.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");if(!/^(\w+:\/\/|\/)/.test(a.url))a.url=
a.page_url+a.url;a.chunk_size=f.parseSize(a.chunk_size);a.max_file_size=f.parseSize(a.max_file_size);d.bind("FilesAdded",function(b,g){var e,k,x=0,q;if((e=a.filters)&&e.length)q=[],f.each(e,function(a){f.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?q.push("\\.*"):q.push("\\."+a.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),q=RegExp(q.join("|")+"$","i");for(e=0;e<g.length;e++)k=g[e],k.loaded=0,k.percent=0,k.status=f.QUEUED,q&&!q.test(k.name)?b.trigger("Error",
{code:f.FILE_EXTENSION_ERROR,message:f.translate("File extension error."),file:k}):k.size!==void 0&&k.size>a.max_file_size?b.trigger("Error",{code:f.FILE_SIZE_ERROR,message:f.translate("File size error."),file:k}):(c.push(k),x++);if(x)p(function(){d.trigger("QueueChanged");d.refresh()},1);else return false});a.unique_names&&d.bind("UploadFile",function(a,c){var b=c.name.match(/\.([^.]+)$/),g="tmp";b&&(g=b[1]);c.target_name=c.id+"."+g});d.bind("UploadProgress",function(a,c){c.percent=c.size>0?Math.ceil(c.loaded/
c.size*100):100;e()});d.bind("StateChanged",function(a){if(a.state==f.STARTED)q=+new Date;else if(a.state==f.STOPPED)for(k=a.files.length-1;k>=0;k--)if(a.files[k].status==f.UPLOADING)a.files[k].status=f.QUEUED,e()});d.bind("QueueChanged",e);d.bind("Error",function(a,c){if(c.file)c.file.status=f.FAILED,e(),a.state==f.STARTED&&p(function(){b.call(d)},1)});d.bind("FileUploaded",function(a,c){c.status=f.DONE;c.loaded=c.size;a.trigger("UploadProgress",c);p(function(){b.call(d)},1)});if(a.runtimes){j=[];
n=a.runtimes.split(/\s?,\s?/);for(k=0;k<n.length;k++)s[n[k]]&&j.push(s[n[k]])}else j=s;g();typeof a.init=="function"?a.init(d):f.each(a.init,function(a,c){d.bind(c,a)})},refresh:function(){this.trigger("Refresh")},start:function(){if(this.state!=f.STARTED)this.state=f.STARTED,this.trigger("StateChanged"),b.call(this)},stop:function(){if(this.state!=f.STOPPED)this.state=f.STOPPED,this.trigger("StateChanged")},getFile:function(a){var b;for(b=c.length-1;b>=0;b--)if(c[b].id===a)return c[b]},removeFile:function(a){var b;
for(b=c.length-1;b>=0;b--)if(c[b].id===a.id)return this.splice(b,1)[0]},splice:function(a,b){var g;g=c.splice(a===void 0?0:a,b===void 0?c.length:b);this.trigger("FilesRemoved",g);this.trigger("QueueChanged");return g},trigger:function(a){var c=d[a.toLowerCase()],b,g;if(c){g=Array.prototype.slice.call(arguments);g[0]=this;for(b=0;b<c.length;b++)if(c[b].func.apply(c[b].scope,g)===false)return false}return true},hasEventListener:function(a){return!!d[a.toLowerCase()]},bind:function(a,c,b){var g,a=a.toLowerCase();
g=d[a]||[];g.push({func:c,scope:b||this});d[a]=g},unbind:function(a,c){var a=a.toLowerCase(),b=d[a],g;if(b){if(c!==void 0)for(g=b.length-1;g>=0;g--){if(b[g].func===c){b.splice(g,1);break}}else b=[];b.length||delete d[a]}},unbindAll:function(){var a=this;f.each(d,function(c,b){a.unbind(b)})},destroy:function(){this.trigger("Destroy");this.unbindAll()}})};f.File=function(a,b,e){this.id=a;this.name=b;this.size=e;this.status=this.percent=this.loaded=0};f.Runtime=function(){this.getFeatures=function(){};
this.init=function(){}};f.QueueProgress=function(){var a=this;a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}};f.runtimes={};window.plupload=f})();
(function(l,h,j,s){function r(a,b){var e;if("FileReader"in l)e=new FileReader,e.readAsDataURL(a),e.onload=function(){b(e.result)};else return b(a.getAsDataURL())}function t(a,b){var e;if("FileReader"in l)e=new FileReader,e.readAsBinaryString(a),e.onload=function(){b(e.result)};else return b(a.getAsBinary())}function v(a,b,e,d){var g,c,q,f,j=this;r(m[a.id],function(k){g=h.createElement("canvas");g.style.display="none";h.body.appendChild(g);c=g.getContext("2d");q=new Image;q.onerror=q.onabort=function(){d({success:false})};
q.onload=function(){var l,h,n,m;if(!b.width)b.width=q.width;if(!b.height)b.height=q.height;f=Math.min(b.width/q.width,b.height/q.height);if(f<1||f===1&&e==="image/jpeg"){l=Math.round(q.width*f);h=Math.round(q.height*f);g.width=l;g.height=h;c.drawImage(q,0,0,l,h);if(e==="image/jpeg"){if(n=new p(atob(k.substring(k.indexOf("base64,")+7))),n.headers&&n.headers.length&&(m=new o,m.init(n.get("exif")[0])&&(m.setExif("PixelXDimension",l),m.setExif("PixelYDimension",h),n.set("exif",m.getBinary()),j.hasEventListener("ExifData")&&
j.trigger("ExifData",a,m.EXIF()),j.hasEventListener("GpsData")&&j.trigger("GpsData",a,m.GPS()))),b.quality)try{k=g.toDataURL(e,b.quality/100)}catch(r){k=g.toDataURL(e)}}else k=g.toDataURL(e);k=k.substring(k.indexOf("base64,")+7);k=atob(k);n&&n.headers&&n.headers.length&&(k=n.restore(k),n.purge());g.parentNode.removeChild(g);d({success:true,data:k})}else d({success:false})};q.src=k})}function u(){function a(a,c){var b=e?0:-8*(c-1),f=0,j;for(j=0;j<c;j++)f|=d.charCodeAt(a+j)<<Math.abs(b+j*8);return f}
function b(a,c,b){b=arguments.length===3?b:d.length-c-1;d=d.substr(0,c)+a+d.substr(b+c)}var e=false,d;return{II:function(a){if(a===s)return e;else e=a},init:function(a){e=false;d=a},SEGMENT:function(a,c,e){switch(arguments.length){case 1:return d.substr(a,d.length-a-1);case 2:return d.substr(a,c);case 3:b(e,a,c);break;default:return d}},BYTE:function(b){return a(b,1)},SHORT:function(b){return a(b,2)},LONG:function(g,c){if(c===s)return a(g,4);else{var d="",j=e?0:-24,f;for(f=0;f<4;f++)d+=String.fromCharCode(c>>
Math.abs(j+f*8)&255);b(d,g,4)}},SLONG:function(b){b=a(b,4);return b>2147483647?b-4294967296:b},STRING:function(b,c){var d="";for(c+=b;b<c;b++)d+=String.fromCharCode(a(b,1));return d}}}function p(a){var b={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},e=[],d,g,c=s,f=0;d=new u;d.init(a);if(d.SHORT(0)===65496){g=2;for(a=Math.min(1048576,a.length);g<=a;)if(c=d.SHORT(g),c>=65488&&
c<=65495)g+=2;else{if(c===65498||c===65497)break;f=d.SHORT(g+2)+2;b[c]&&d.STRING(g+4,b[c].signature.length)===b[c].signature&&e.push({hex:c,app:b[c].app.toUpperCase(),name:b[c].name.toUpperCase(),start:g,length:f,segment:d.SEGMENT(g,f)});g+=f}d.init(null);return{headers:e,restore:function(a){d.init(a);var b=new p(a);if(!b.headers)return false;for(a=b.headers.length;a>0;a--){var c=b.headers[a-1];d.SEGMENT(c.start,c.length,"")}b.purge();g=d.SHORT(2)==65504?4+d.SHORT(4):2;a=0;for(b=e.length;a<b;a++)d.SEGMENT(g,
0,e[a].segment),g+=e[a].length;return d.SEGMENT()},get:function(a){for(var b=[],c=0,g=e.length;c<g;c++)e[c].app===a.toUpperCase()&&b.push(e[c].segment);return b},set:function(a,b){var c=[];typeof b==="string"?c.push(b):c=b;for(var g=ii=0,d=e.length;g<d;g++){if(e[g].app===a.toUpperCase())e[g].segment=c[ii],e[g].length=c[ii].length,ii++;if(ii>=c.length)break}},purge:function(){e=[];d.init(null)}}}}function o(){function a(a,e){var f=b.SHORT(a),j,k,l,h,n,m=[],p={};for(j=0;j<f;j++)if(n=a+12*j+2,l=e[b.SHORT(n)],
l!==s){k=b.SHORT(n+=2);h=b.LONG(n+=2);n+=4;m=[];switch(k){case 1:case 7:h>4&&(n=b.LONG(n)+d.tiffHeader);for(k=0;k<h;k++)m[k]=b.BYTE(n+k);break;case 2:h>4&&(n=b.LONG(n)+d.tiffHeader);p[l]=b.STRING(n,h-1);continue;case 3:h>2&&(n=b.LONG(n)+d.tiffHeader);for(k=0;k<h;k++)m[k]=b.SHORT(n+k*2);break;case 4:h>1&&(n=b.LONG(n)+d.tiffHeader);for(k=0;k<h;k++)m[k]=b.LONG(n+k*4);break;case 5:n=b.LONG(n)+d.tiffHeader;for(k=0;k<h;k++)m[k]=b.LONG(n+k*4)/b.LONG(n+k*4+4);break;case 9:n=b.LONG(n)+d.tiffHeader;for(k=0;k<
h;k++)m[k]=b.SLONG(n+k*4);break;case 10:n=b.LONG(n)+d.tiffHeader;for(k=0;k<h;k++)m[k]=b.SLONG(n+k*4)/b.SLONG(n+k*4+4);break;default:continue}h=h==1?m[0]:m;p[l]=g.hasOwnProperty(l)&&typeof h!="object"?g[l][h]:h}return p}var b,e,d={},g;b=new u;e={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",
37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};g={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",
2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",
9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(c){d={tiffHeader:10};
if(c===s||!c.length)return false;b.init(c);b.SHORT(0)===65505&&b.STRING(4,5).toUpperCase()==="EXIF\x00"?(c=s,c=d.tiffHeader,b.II(b.SHORT(c)==18761),b.SHORT(c+=2)!==42?c=false:(d.IFD0=d.tiffHeader+b.LONG(c+2),c=a(d.IFD0,e.tiff),d.exifIFD="ExifIFDPointer"in c?d.tiffHeader+c.ExifIFDPointer:s,d.gpsIFD="GPSInfoIFDPointer"in c?d.tiffHeader+c.GPSInfoIFDPointer:s,c=true)):c=false;return c},EXIF:function(){var b;b=a(d.exifIFD,e.exif);if(b.ExifVersion)b.ExifVersion=String.fromCharCode(b.ExifVersion[0],b.ExifVersion[1],
b.ExifVersion[2],b.ExifVersion[3]);return b},GPS:function(){var b;b=a(d.gpsIFD,e.gps);if(b.GPSVersionID)b.GPSVersionID=b.GPSVersionID.join(".");return b},setExif:function(a,g){var f;if(a!=="PixelXDimension"&&a!=="PixelYDimension")f=false;else{f=a;var j,k,l,h=0;if(typeof f==="string")for(hex in j=e.exif,j)if(j[hex]===f){f=hex;break}j=d.exifIFD;k=b.SHORT(j);for(i=0;i<k;i++)if(l=j+12*i+2,b.SHORT(l)==f){h=l+8;break}h?(b.LONG(h,g),f=true):f=false}return f},getBinary:function(){return b.SEGMENT()}}}var m=
{},f;j.runtimes.Html5=j.addRuntime("html5",{getFeatures:function(){var a,b,e,d,g,c;b=e=g=c=false;l.XMLHttpRequest&&(a=new XMLHttpRequest,e=!!a.upload,b=!(!a.sendAsBinary&&!a.upload));b&&(d=!!(a.sendAsBinary||l.Uint8Array&&l.ArrayBuffer),g=!(!File||!File.prototype.getAsDataURL&&!l.FileReader||!d),c=!(!File||!File.prototype.mozSlice&&!File.prototype.webkitSlice&&!File.prototype.slice));f=j.ua.safari&&j.ua.windows;a=b;b=h.createElement("div");return{html5:a,dragdrop:"draggable"in b||"ondragstart"in b&&
"ondrop"in b,jpgresize:g,pngresize:g,multipart:g||!!l.FileReader||!!l.FormData,canSendBinary:d,cantSendBlobInFormData:!(!j.ua.gecko||!l.FormData||!l.FileReader||FileReader.prototype.readAsArrayBuffer),progress:e,chunks:c,multi_selection:!(j.ua.safari&&j.ua.windows),triggerDialog:j.ua.gecko&&l.FormData||j.ua.webkit}},init:function(a,b){function e(b){var c,d,e=[],f,k={};for(d=0;d<b.length;d++)c=b[d],k[c.name]||(k[c.name]=true,f=j.guid(),m[f]=c,e.push(new j.File(f,c.fileName||c.name,c.fileSize||c.size)));
e.length&&a.trigger("FilesAdded",e)}var d;d=this.getFeatures();d.html5?(a.bind("Init",function(b){var c,d,f=[],l,k,m=b.settings.filters,p,n;l=h.body;c=h.createElement("div");c.id=b.id+"_html5_container";j.extend(c.style,{position:"absolute",background:a.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:a.settings.shim_bgcolor?"":0});c.className="plupload html5";if(a.settings.container&&(l=h.getElementById(a.settings.container),j.getStyle(l,"position")===
"static"))l.style.position="relative";l.appendChild(c);l=0;a:for(;l<m.length;l++){p=m[l].extensions.split(/,/);for(k=0;k<p.length;k++){if(p[k]==="*"){f=[];break a}(n=j.mimeTypes[p[k]])&&f.push(n)}}c.innerHTML='<input id="'+a.id+'_html5"  style="font-size:999px" type="file" accept="'+f.join(",")+'" '+(a.settings.multi_selection&&a.features.multi_selection?'multiple="multiple"':"")+" />";c.scrollTop=100;f=h.getElementById(a.id+"_html5");b.features.triggerDialog?j.extend(f.style,{position:"absolute",
width:"100%",height:"100%"}):j.extend(f.style,{cssFloat:"right",styleFloat:"right"});f.onchange=function(){e(this.files);this.value=""};if(d=h.getElementById(b.settings.browse_button)){var o=b.settings.browse_button_hover,r=b.settings.browse_button_active;c=b.features.triggerDialog?d:c;o&&(j.addEvent(c,"mouseover",function(){j.addClass(d,o)},b.id),j.addEvent(c,"mouseout",function(){j.removeClass(d,o)},b.id));r&&(j.addEvent(c,"mousedown",function(){j.addClass(d,r)},b.id),j.addEvent(h.body,"mouseup",
function(){j.removeClass(d,r)},b.id));b.features.triggerDialog&&j.addEvent(d,"click",function(a){h.getElementById(b.id+"_html5").click();a.preventDefault()},b.id)}}),a.bind("PostInit",function(){var b=h.getElementById(a.settings.drop_element);b&&(f?j.addEvent(b,"dragenter",function(){var c,d;c=h.getElementById(a.id+"_drop");c||(c=h.createElement("input"),c.setAttribute("type","file"),c.setAttribute("id",a.id+"_drop"),c.setAttribute("multiple","multiple"),j.addEvent(c,"change",function(){e(this.files);
j.removeEvent(c,"change",a.id);c.parentNode.removeChild(c)},a.id),b.appendChild(c));j.getPos(b,h.getElementById(a.settings.container));d=j.getSize(b);j.getStyle(b,"position")==="static"&&j.extend(b.style,{position:"relative"});j.extend(c.style,{position:"absolute",display:"block",top:0,left:0,width:d.w+"px",height:d.h+"px",opacity:0})},a.id):(j.addEvent(b,"dragover",function(a){a.preventDefault()},a.id),j.addEvent(b,"drop",function(a){var b=a.dataTransfer;b&&b.files&&e(b.files);a.preventDefault()},
a.id)))}),a.bind("Refresh",function(b){var c,d,e;if(c=h.getElementById(a.settings.browse_button))d=j.getPos(c,h.getElementById(b.settings.container)),e=j.getSize(c),b=h.getElementById(a.id+"_html5_container"),j.extend(b.style,{top:d.y+"px",left:d.x+"px",width:e.w+"px",height:e.h+"px"}),a.features.triggerDialog&&(j.getStyle(c,"position")==="static"&&j.extend(c.style,{position:"relative"}),d=parseInt(j.getStyle(c,"z-index"),10),isNaN(d)&&(d=0),j.extend(c.style,{zIndex:d}),j.extend(b.style,{zIndex:d-
1}))}),a.bind("UploadFile",function(a,b){function e(a,b,c){var d;if(File.prototype.slice)try{return a.slice(),a.slice(b,c)}catch(g){return a.slice(b,c-b)}else return(d=File.prototype.webkitSlice||File.prototype.mozSlice)?d.call(a,b,c):null}function f(k){function m(){function f(e){var k=0,h=new XMLHttpRequest,o=h.upload,q="----pluploadboundary"+j.guid(),y,w="";if(o)o.onprogress=function(d){b.loaded=Math.min(b.size,p+d.loaded-k);a.trigger("UploadProgress",b)};h.onreadystatechange=function(){var d,f;
if(h.readyState==4){try{d=h.status}catch(k){d=0}if(d>=400)a.trigger("Error",{code:j.HTTP_ERROR,message:j.translate("HTTP Error."),file:b,status:d});else{if(s){f={chunk:n,chunks:s,response:h.responseText,status:d};a.trigger("ChunkUploaded",b,f);p+=v;if(f.cancelled){b.status=j.FAILED;return}b.loaded=Math.min(b.size,(n+1)*t)}else b.loaded=b.size;a.trigger("UploadProgress",b);e=r=y=w=null;!s||++n>=s?(b.status=j.DONE,a.trigger("FileUploaded",b,{response:h.responseText,status:d})):m()}h=null}};if(a.settings.multipart&&
d.multipart){u.name=b.target_name||b.name;h.open("post",A,true);j.each(a.settings.headers,function(a,b){h.setRequestHeader(b,a)});if(typeof e!=="string"&&l.FormData){y=new FormData;j.each(j.extend(u,a.settings.multipart_params),function(a,b){y.append(b,a)});y.append(a.settings.file_data_name,e);h.send(y);return}if(typeof e==="string"){h.setRequestHeader("Content-Type","multipart/form-data; boundary="+q);j.each(j.extend(u,a.settings.multipart_params),function(a,b){w+="--"+q+'\r\nContent-Disposition: form-data; name="'+
b+'"\r\n\r\n';w+=unescape(encodeURIComponent(a))+"\r\n"});x=j.mimeTypes[b.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";w+="--"+q+'\r\nContent-Disposition: form-data; name="'+a.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(b.name))+'"\r\nContent-Type: '+x+"\r\n\r\n"+e+"\r\n--"+q+"--\r\n";k=w.length-e.length;e=w;if(h.sendAsBinary)h.sendAsBinary(e);else if(d.canSendBinary){for(var o=new Uint8Array(e.length),z=0;z<e.length;z++)o[z]=e.charCodeAt(z)&
255;h.send(o.buffer)}return}}A=j.buildUrl(a.settings.url,j.extend(u,a.settings.multipart_params));h.open("post",A,true);h.setRequestHeader("Content-Type","application/octet-stream");j.each(a.settings.headers,function(a,b){h.setRequestHeader(b,a)});h.send(e)}var r,s,u,t,v,x,A=a.settings.url;if(!(b.status==j.DONE||b.status==j.FAILED||a.state==j.STOPPED))u={name:b.target_name||b.name},h.chunk_size&&b.size>h.chunk_size&&(d.chunks||typeof k=="string")?(t=h.chunk_size,s=Math.ceil(b.size/t),v=Math.min(t,
b.size-n*t),r=typeof k=="string"?k.substring(n*t,n*t+v):e(k,n*t,n*t+v),u.chunk=n,u.chunks=s):(v=b.size,r=k),typeof r!=="string"&&o&&d.cantSendBlobInFormData&&d.chunks&&a.settings.chunk_size?(o.onload=function(){f(o.result)},o.readAsBinaryString(r)):f(r)}var n=0,p=0,o="FileReader"in l?new FileReader:null;m()}var h=a.settings,k;k=m[b.id];d.jpgresize&&a.settings.resize&&/\.(png|jpg|jpeg)$/i.test(b.name)?v.call(a,b,a.settings.resize,/\.png$/i.test(b.name)?"image/png":"image/jpeg",function(a){a.success?
(b.size=a.data.length,f(a.data)):f(k)}):!d.chunks&&d.jpgresize?t(k,f):f(k)}),a.bind("Destroy",function(a){var b,d,e=h.body,f={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(b in f)(d=h.getElementById(f[b]))&&j.removeAllEvents(d,a.id);j.removeAllEvents(h.body,a.id);a.settings.container&&(e=h.getElementById(a.settings.container));e.removeChild(h.getElementById(f.inputContainer))}),b({success:true})):b({success:false})}})})(window,
document,plupload);
(function(l){function h(h){return plupload.translate(h)||h}function j(j,s){s.contents().each(function(j,h){h=l(h);h.is(".plupload")||h.remove()});s.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+j+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+h("Select photos")+'</div><div class="plupload_header_text">'+h("Add photos and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_footer"> <div class="plupload_file_name"> <div class="plupload_buttons"><a href="#" class="plupload_button plupload_add">'+
h("Add photos")+'</a><a href="#" class="plupload_button plupload_start">'+h("Start upload")+'</a></div> <span class="plupload_upload_status"></span> </div> <div class="plupload_file_action"></div> <div class="plupload_file_status"><span class="plupload_total_status">0%</span></div> <div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div> <div class="plupload_progress"> <div class="plupload_progress_container"> <div class="plupload_progress_bar"></div> </div> </div> <div class="plupload_clearer">&nbsp;</div> </div><div class="plupload_filelist_header"><div class="plupload_file_name">'+
h("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+h("Status")+'</span></div><div class="plupload_file_size">'+h("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+j+'_filelist" class="plupload_filelist"></ul></div></div></div><input type="hidden" id="'+j+'_count" name="'+j+'_count" value="0" /></div>')}var s={};l.fn.pluploadQueue=function(r){return r?(this.each(function(){function t(f){var a;f.status==plupload.DONE&&
(a="plupload_done");f.status==plupload.FAILED&&(a="plupload_failed");f.status==plupload.QUEUED&&(a="plupload_delete");f.status==plupload.UPLOADING&&(a="plupload_uploading");a=l("#"+f.id).attr("class",a).find("a").css("display","block");f.hint&&a.attr("title",f.hint)}function v(){l("span.plupload_total_status",o).html(p.total.percent+"%");l("div.plupload_progress_bar",o).css("width",p.total.percent+"%");l("span.plupload_upload_status",o).text(h("Uploaded %d/%d photos").replace(/%d\/%d/,p.total.uploaded+
"/"+p.files.length))}function u(){var f=l("ul.plupload_filelist",o).html(""),a=0,b;l.each(p.files,function(e,d){b="";d.status==plupload.DONE&&(d.target_name&&(b+='<input type="hidden" name="'+m+"_"+a+'_tmpname" value="'+plupload.xmlEncode(d.target_name)+'" />'),b+='<input type="hidden" name="'+m+"_"+a+'_name" value="'+plupload.xmlEncode(d.name)+'" />',b+='<input type="hidden" name="'+m+"_"+a+'_status" value="'+(d.status==plupload.DONE?"done":"failed")+'" />',a++,l("#"+m+"_count").val(a));f.append('<li id="'+
d.id+'"><div class="plupload_file_name"><span>'+d.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+d.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(d.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+b+"</li>");t(d);l("#"+d.id+".plupload_delete a").click(function(a){l("#"+d.id).remove();p.removeFile(d);a.preventDefault()})});l("span.plupload_total_file_size",o).html(plupload.formatSize(p.total.size));p.total.queued===
0?l("span.plupload_add_text",o).text(h("Add photos.")):l("span.plupload_add_text",o).text(p.total.queued+" photos queued.");l("a.plupload_start",o).toggleClass("plupload_disabled",p.files.length==p.total.uploaded+p.total.failed);f[0].scrollTop=f[0].scrollHeight;v();!p.files.length&&p.features.dragdrop&&p.settings.dragdrop&&l("#"+m+"_filelist").append('<li class="plupload_droptext">'+h("Drag and drop photos here.")+"</li>")}var p,o,m;o=l(this);m=o.attr("id");m||(m=plupload.guid(),o.attr("id",m));p=
new plupload.Uploader(l.extend({dragdrop:true,container:m},r));s[m]=p;p.bind("UploadFile",function(f,a){l("#"+a.id).addClass("plupload_current_file")});p.bind("Init",function(f,a){j(m,o);!r.unique_names&&r.rename&&l("#"+m+"_filelist div.plupload_file_name span",o).live("click",function(a){var e=l(a.target),d,g,c="";d=f.getFile(e.parents("li")[0].id);g=d.name;if(a=/^(.+)(\.[^.]+)$/.exec(g))g=a[1],c=a[2];e.hide().after('<input type="text" />');e.next().val(g).focus().blur(function(){e.show().next().remove()}).keydown(function(a){var b=
l(this);if(a.keyCode==13)a.preventDefault(),d.name=b.val()+c,e.text(d.name),b.blur()})});l("a.plupload_add",o).attr("id",m+"_browse");f.settings.browse_button=m+"_browse";if(f.features.dragdrop&&f.settings.dragdrop)f.settings.drop_element=m+"_filelist",l("#"+m+"_filelist").append('<li class="plupload_droptext">'+h("Drag and drop photos here.")+"</li>");l("#"+m+"_container").attr("title","Using runtime: "+a.runtime);l("a.plupload_start",o).click(function(a){l(this).hasClass("plupload_disabled")||p.start();
a.preventDefault()});l("a.plupload_stop",o).click(function(a){a.preventDefault();p.stop()});l("a.plupload_start",o).addClass("plupload_disabled")});p.init();p.bind("Error",function(f,a){var b=a.file,e;if(b)e=a.message,a.details&&(e+=" ("+a.details+")"),a.code==plupload.FILE_SIZE_ERROR&&alert(h("Error: File too large: ")+b.name),a.code==plupload.FILE_EXTENSION_ERROR&&alert(h("Error: Invalid file extension: ")+b.name),b.hint=e,l("#"+b.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",
e)});p.bind("StateChanged",function(){p.state===plupload.STARTED?(l("li.plupload_delete a,div.plupload_buttons",o).hide(),l("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",o).css("display","block"),l("span.plupload_upload_status",o).text("Uploaded "+p.total.uploaded+"/"+p.files.length+" photos"),r.multiple_queues&&l("span.plupload_total_status,span.plupload_total_file_size",o).show()):(u(),l("a.plupload_stop,div.plupload_progress",o).hide(),l("a.plupload_delete",o).css("display",
"block"))});p.bind("QueueChanged",u);p.bind("FileUploaded",function(f,a){t(a)});p.bind("UploadProgress",function(f,a){l("#"+a.id+" div.plupload_file_status",o).html(a.percent+"%");t(a);v();r.multiple_queues&&p.total.uploaded+p.total.failed==p.files.length&&(l(".plupload_buttons,.plupload_upload_status",o).css("display","inline"),l(".plupload_start",o).addClass("plupload_disabled"),l("span.plupload_total_status,span.plupload_total_file_size",o).hide())});r.setup&&r.setup(p)}),this):s[l(this[0]).attr("id")]}})(jQuery);
OPU=function(){return{init:function(){var l=$("#uploader");l.length!=0&&(l.pluploadQueue({runtimes:"html5",url:"/photo/upload.json",max_file_size:"32mb",unique_names:true,filters:[{title:"Photos",extensions:"jpg,jpeg,gif,png"}],flash_swf_url:"plupload.flash.swf",multipart_params:{crumb:$("form.upload input.crumb").val()},preinit:{BeforeUpload:function(){var h=$("#uploader").pluploadQueue();$(".upload-progress .total").html(h.files.length);$(".upload-progress .completed").html(h.total.uploaded+1);
$(".upload-progress").slideDown("fast")},UploadComplete:function(){$(".upload-progress").fadeOut("fast",function(){$(".upload-complete").fadeIn("fast")})},UploadFile:function(){var h=$("#uploader").pluploadQueue(),j,l,r;j=$("form.upload select[name='license'] :selected").val();j.length==0&&(j=$("form.upload input[name='custom']").val());r=$("form.upload input[name='tags']").val();l=$("form.upload input[name='permission']:checked").val();h.settings.multipart_params.license=j;h.settings.multipart_params.tags=
r;h.settings.multipart_params.permission=l}}}),$("form.upload").submit(function(){var h=$("#uploader").pluploadQueue({});h.files.length>0?(h.bind("StateChanged",function(){h.files.length===h.total.uploaded+h.total.failed&&$("form.upload")[0].submit()}),h.start()):alert("Please select at least one photo to upload.");return false}),l=$("#uploader .insufficient"),l.length==1&&l.show())}}}();
